!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("vue-virtual-draglist",[],e):"object"==typeof exports?exports["vue-virtual-draglist"]=e():t["vue-virtual-draglist"]=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=5)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n.n(i);for(var s in i)["default","default"].indexOf(s)<0&&function(t){n.d(e,t,function(){return i[t]})}(s);e.default=r.a},function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(9),s=function(t){return t&&t.__esModule?t:{default:t}}(r),a={INIT:"INIT",FIXED:"FIXED",DYNAMIC:"DYNAMIC"};e.default={name:"infinity-list",components:{Item:s.default},props:{dataSource:{type:Array,default:function(){return[]}},dataKey:{type:String,required:!0},height:{type:String,default:"100%"},keeps:{type:Number,default:40},size:{type:Number}},data:function(){return{list:[],sizeStack:new Map,positionStack:[],screenHeight:0,start:0,end:0,uniqueKeys:[],calcType:a.INIT,lastCalcIndex:0,firstAverageSize:0,firstTotalSize:0,fixedSize:0}},computed:{_visibleData:function(){return this.list.slice(this.start,this.end)},_anchorPoint:function(){return this.positionStack.length?this.positionStack[this.start]:null},getIndex:function(){return function(t){return this.list.findIndex(function(e){return uniqueId(t)==uniqueId(e)})}}},watch:{dataSource:{handler:function(t){var e=this;this.list=JSON.parse(JSON.stringify(t)),this.uniqueKeys=this.list.map(function(t){return e.uniqueId(t)}),this.handleSourceDataChange(),this.updateSizeStack()},deep:!0,immediate:!0}},updated:function(){var t=this;this.$nextTick(function(){t.updateOffset()})},mounted:function(){this.screenHeight=Math.ceil(this.$el.clientHeight),this.end=this.start+this.keeps,this.updateOffset()},methods:{scrollToBottom:function(){var t=this,e=this.$refs.bottomItem;if(e){var n=e.offsetTop;this.scrollToOffset(n)}var i=this.$refs.infinityList.scrollTop,r=this.$refs.infinityList.scrollHeight;setTimeout(function(){i+t.screenHeight<r&&t.scrollToBottom()},3)},scrollToOffset:function(t){this.$refs.infinityList.scrollTop=t},scrollToIndex:function(t){if(t>=this.list.length-1)this.scrollToBottom();else{var e=this.getIndexOffset(t);this.scrollToOffset(e)}},handleScroll:function(t){var e=this.$refs.infinityList.scrollTop,n=this.getScrollOvers(e),i=Math.max(n-Math.round(this.keeps/3),0);this.updateRange(i,this.getEndByStart(n))},onItemResized:function(t,e){this.sizeStack.set(t,e),this.calcType===a.INIT?(this.fixedSize=e,this.calcType=a.FIXED,this.initSizeStack()):this.calcType===a.FIXED&&this.fixedSize!==e&&(this.calcType=a.DYNAMIC,delete this.fixedSize),this.calcType!==a.FIXED&&"undefined"!==this.firstTotalSize&&(this.sizeStack.size<Math.min(this.keeps,this.uniqueKeys.length)?(this.firstTotalSize=[].concat(i(this.sizeStack.values())).reduce(function(t,e){return t+e},0),this.firstAverageSize=Math.round(this.firstTotalSize/this.sizeStack.size)):delete this.firstTotalSize)},handleSourceDataChange:function(){var t=Math.max(this.start,0);this.updateRange(this.start,this.getEndByStart(t))},initSizeStack:function(){var t=this;this.list.forEach(function(e){var n=t.uniqueId(e);t.sizeStack.set(n,t.firstAverageSize)})},updateSizeStack:function(){var t=this;this.sizeStack.forEach(function(e,n){t.uniqueKeys.includes(n)||t.sizeStack.delete(n)})},updateRange:function(t,e){var n=this.keeps;this.uniqueKeys.length<=n?(t=0,e=this.getLastIndex()):e-t<n-1&&(t=e-n+1),this.start!==t&&(this.start=t,this.end=e)},updateOffset:function(){this.$refs.content.style.padding=this.getPadFront()+"px 0px "+this.getPadBehind()+"px"},getScrollOvers:function(t){if(t<=0)return 0;if(this.isFixedType())return Math.floor(t/this.fixedSize);for(var e=0,n=0,i=0,r=this.uniqueKeys.length;e<=r;){if(n=e+Math.floor((r-e)/2),(i=this.getIndexOffset(n))===t)return n;i<t?e=n+1:i>t&&(r=n-1)}return e>0?--e:0},getIndexOffset:function(t){if(!t)return 0;for(var e=0,n=0,i=0;i<t;i++)n=this.sizeStack.get(this.uniqueKeys[i]),e+="number"==typeof n?n:this.getEstimateSize();return this.lastCalcIndex=Math.max(this.lastCalcIndex,t-1),this.lastCalcIndex=Math.min(this.lastCalcIndex,this.getLastIndex()),e},getLastIndex:function(){return this.uniqueKeys.length-1},getEndByStart:function(t){var e=t+this.keeps;return Math.min(e,this.getLastIndex())},getPadFront:function(){return this.isFixedType()?this.fixedSize*this.start:this.getIndexOffset(this.start)},getPadBehind:function(){var t=this.end,e=this.getLastIndex();return this.isFixedType()?(e-t)*this.fixedSize:this.lastCalcIndex===e?this.getIndexOffset(e)-this.getIndexOffset(t):(e-t)*this.getEstimateSize()},getEstimateSize:function(){return this.isFixedType()?this.fixedSize:this.firstAverageSize||this.size},isFixedType:function(){return this.calcType===a.FIXED},uniqueId:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.dataKey;return(Array.isArray(n)?n:n.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce(function(t,e){return(t||{})[e]},t)||e}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n.n(i);for(var s in i)["default","default"].indexOf(s)<0&&function(t){n.d(e,t,function(){return i[t]})}(s);e.default=r.a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"vue-virtual-draglist-item",props:{item:{},index:{},uniqueKey:{}},data:function(){return{resizeObserver:null}},updated:function(){this.dispatchSizeChange()},mounted:function(){var t=this;"undefined"!=typeof ResizeObserver&&(this.resizeObserver=new ResizeObserver(function(){t.dispatchSizeChange()}),this.resizeObserver.observe(this.$el))},beforeDestroy:function(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)},methods:{dispatchSizeChange:function(){this.$emit("resize",this.uniqueKey,this.getCurrentSize())},getCurrentSize:function(){return this.$el?this.$el.offsetHeight:0}}}},function(t,e,n){"use strict";function i(t,e,n,i,r,s,a,o){var u="function"==typeof t?t.options:t;e&&(u.render=e,u.staticRenderFns=n,u._compiled=!0),i&&(u.functional=!0),s&&(u._scopeId="data-v-"+s);var c;if(a?(c=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},u._ssrRegister=c):r&&(c=o?function(){r.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:r),c)if(u.functional){u._injectStyles=c;var f=u.render;u.render=function(t,e){return c.call(e),f(t,e)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,c):[c]}return{exports:t,options:u}}e.a=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6),r=function(t){return t&&t.__esModule?t:{default:t}}(i);e.default=r.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7),r=n(0);for(var s in r)["default","default"].indexOf(s)<0&&function(t){n.d(e,t,function(){return r[t]})}(s);var a=(n(12),n(4)),o=Object(a.a)(r.default,i.a,i.b,!1,null,"745efa42",null);e.default=o.exports},function(t,e,n){"use strict";var i=n(8);n.d(e,"a",function(){return i.a}),n.d(e,"b",function(){return i.b})},function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"b",function(){return r});var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"parent",staticStyle:{height:"100%"}},[n("div",{ref:"infinityList",staticClass:"infinity-list-scroll",style:{height:t.height},on:{scroll:function(e){return t.handleScroll(e)}}},[n("div",{ref:"content",staticClass:"infinity-list-content"},t._l(t._visibleData,function(e,i){return n("Item",{key:t.uniqueId(e),attrs:{index:t.getIndex,item:e,uniqueKey:t.uniqueId(e)},on:{resize:t.onItemResized},scopedSlots:t._u([{key:"item",fn:function(e){var n=e.record,i=e.index;return[t._t("item",null,{record:n,index:i})]}}],null,!0)})}),1),t._v(" "),n("div",{ref:"bottomItem"})])])},r=[]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),r=n(2);for(var s in r)["default","default"].indexOf(s)<0&&function(t){n.d(e,t,function(){return r[t]})}(s);var a=n(4),o=Object(a.a)(r.default,i.a,i.b,!1,null,null,null);e.default=o.exports},function(t,e,n){"use strict";var i=n(11);n.d(e,"a",function(){return i.a}),n.d(e,"b",function(){return i.b})},function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"b",function(){return r});var i=function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"infinity-list-item"},[t._t("item",null,{record:t.item,index:t.index})],2)},r=[]},function(t,e,n){"use strict";var i=n(13);n.n(i)},function(t,e,n){var i=n(14);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var r=n(16).default;r("0ff0dc2c",i,!0,{})},function(t,e,n){e=n(15)(!1),e.push([t.i,"\n.infinity-list-scroll[data-v-745efa42] {\r\n  width: 100%;\r\n  overflow-x: hidden;\r\n  overflow-y: auto;\r\n  position: relative;\n}\r\n",""]),t.exports=e},function(t,e,n){"use strict";function i(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var s=r(i);return[n].concat(i.sources.map(function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")})).concat([s]).join("\n")}return[n].join("\n")}function r(t){return"/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(t)))))," */")}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=i(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n}).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(i)for(var s=0;s<this.length;s++){var a=this[s][0];null!=a&&(r[a]=!0)}for(var o=0;o<t.length;o++){var u=[].concat(t[o]);i&&r[u[0]]||(n&&(u[2]?u[2]="".concat(n," and ").concat(u[2]):u[2]=n),e.push(u))}},e}},function(t,e,n){"use strict";function i(t,e,n,i){v=n,y=i||{};var s=Object(c.a)(t,e);return r(s),function(e){for(var n=[],i=0;i<s.length;i++){var a=s[i],o=d[a.id];o.refs--,n.push(o)}e?(s=Object(c.a)(t,e),r(s)):s=[];for(var i=0;i<n.length;i++){var o=n[i];if(0===o.refs){for(var u=0;u<o.parts.length;u++)o.parts[u]();delete d[o.id]}}}}function r(t){for(var e=0;e<t.length;e++){var n=t[e],i=d[n.id];if(i){i.refs++;for(var r=0;r<i.parts.length;r++)i.parts[r](n.parts[r]);for(;r<n.parts.length;r++)i.parts.push(a(n.parts[r]));i.parts.length>n.parts.length&&(i.parts.length=n.parts.length)}else{for(var s=[],r=0;r<n.parts.length;r++)s.push(a(n.parts[r]));d[n.id]={id:n.id,refs:1,parts:s}}}}function s(){var t=document.createElement("style");return t.type="text/css",l.appendChild(t),t}function a(t){var e,n,i=document.querySelector("style["+m+'~="'+t.id+'"]');if(i){if(v)return g;i.parentNode.removeChild(i)}if(S){var r=p++;i=h||(h=s()),e=o.bind(null,i,r,!1),n=o.bind(null,i,r,!0)}else i=s(),e=u.bind(null,i),n=function(){i.parentNode.removeChild(i)};return e(t),function(i){if(i){if(i.css===t.css&&i.media===t.media&&i.sourceMap===t.sourceMap)return;e(t=i)}else n()}}function o(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=x(e,r);else{var s=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(s,a[e]):t.appendChild(s)}}function u(t,e){var n=e.css,i=e.media,r=e.sourceMap;if(i&&t.setAttribute("media",i),y.ssrId&&t.setAttribute(m,e.id),r&&(n+="\n/*# sourceURL="+r.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var c=n(17),f="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!f)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var d={},l=f&&(document.head||document.getElementsByTagName("head")[0]),h=null,p=0,v=!1,g=function(){},y=null,m="data-vue-ssr-id",S="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase()),x=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e,n){"use strict";function i(t,e){for(var n=[],i={},r=0;r<e.length;r++){var s=e[r],a=s[0],o=s[1],u=s[2],c=s[3],f={id:t+":"+r,css:o,media:u,sourceMap:c};i[a]?i[a].parts.push(f):n.push(i[a]={id:a,parts:[f]})}return n}e.a=i}])});
//# sourceMappingURL=vue-virtual-draglist.js.map