!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("vue-virtual-drag-list",[],e):"object"==typeof exports?exports["vue-virtual-drag-list"]=e():t["vue-virtual-drag-list"]=e()}(window,(function(){return function(t){function e(e){for(var n,a,o=e[0],u=e[1],l=e[2],c=0,h=[];c<o.length;c++)a=o[c],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&h.push(r[a][0]),r[a]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);for(d&&d(e);h.length;)h.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,o=1;o<i.length;o++){var u=i[o];0!==r[u]&&(n=!1)}n&&(s.splice(e--,1),t=a(a.s=i[0]))}return t}var n={},r={0:0},s=[];function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/dist/";var o=window.webpackJsonpvue_virtual_drag_list=window.webpackJsonpvue_virtual_drag_list||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var d=u;return s.push([5,1]),i()}([function(t,e,i){"use strict";i.r(e);var n=i(1),r=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e.default=r.a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7);e.default={name:"infinity-list",components:{Items:n.Items,Slots:n.Slots},props:{dataSource:{type:Array,default:function(){return[]}},dataKey:{type:String,required:!0},height:{type:String,default:"100%"},keeps:{type:Number,default:30},size:{type:Number},draggable:{type:Boolean,default:!0},headerTag:{type:String,default:"div"},footerTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},itemStyle:{type:Object,default:function(){}},itemClass:{type:String,default:""},dragStyle:{type:Object,default:function(){return{backgroundImage:"linear-gradient(to bottom, rgba(255, 255, 255, 0.1) 0%, rgba(0, 0, 0, 0.1) 40%, rgba(0, 0, 0, 0.1) 98%, #FFFFFF 100%)"}}}},data:function(){return{list:[],sizeStack:new Map,screenHeight:0,start:0,end:0,offset:0,direction:"",uniqueKeys:[],lastCalcIndex:0,calcType:"INIT",calcSize:{average:0,total:0,fixed:0,header:0,footer:0},padding:{front:0,behind:0},dragState:{oldNode:null,oldItem:null,oldIndex:null,newNode:null,newIitem:null,newIndex:null}}},computed:{visibleData:function(){return this.list.slice(this.start,this.end)},getIndex:function(){return function(t){var e=this;return this.list.findIndex((function(i){return e.uniqueId(t)==e.uniqueId(i)}))}},uniqueKeyLen:function(){return this.uniqueKeys.length-1},isFixedType:function(){return"FIXED"===this.calcType}},watch:{dataSource:{handler:function(t){var e=this;this.list=JSON.parse(JSON.stringify(t)),this.uniqueKeys=this.list.map((function(t){return e.uniqueId(t)})),this.handleSourceDataChange(),this.updateSizeStack()},deep:!0,immediate:!0}},beforeCreate:function(){var t=this.$slots,e=t.header,i=t.footer;this.header=e,this.footer=i},mounted:function(){this.screenHeight=Math.ceil(this.$el.clientHeight),this.end=this.start+this.keeps},methods:{scrollToBottom:function(){var t=this,e=this.$refs,i=e.bottomItem,n=e.virtualDragList;if(i){var r=i.offsetTop;this.scrollToOffset(r)}var s=this.$el.clientHeight,a=n.scrollTop,o=n.scrollHeight;setTimeout((function(){a+s<o&&t.scrollToBottom()}),10)},scrollToOffset:function(t){this.$refs.virtualDragList.scrollTop=t},scrollToIndex:function(t){if(t>=this.list.length-1)this.scrollToBottom();else{var e=this.getOffsetByIndex(t);this.scrollToOffset(e)}},handleScroll:function(t){var e=this.$refs.virtualDragList,i=Math.ceil(this.$el.clientHeight),n=Math.ceil(e.scrollTop),r=Math.ceil(e.scrollHeight);if(!(n<0||n+i>r+1)&&r){this.direction=n<this.offset?"FRONT":"BEHIND",this.offset=n;var s=this.getScrollOvers();"FRONT"===this.direction?(this.handleFront(s),this.list.length&&n<=0&&this.$emit("top")):"BEHIND"===this.direction&&(this.handleBehind(s),i+n>=r&&this.$emit("bottom"))}},handleFront:function(t){if(!(t>this.start)){var e=Math.max(t-Math.round(this.keeps/3),0);this.checkRange(e,this.getEndByStart(e))}},handleBehind:function(t){t<this.start+Math.round(this.keeps/3)||this.checkRange(t,this.getEndByStart(t))},onItemResized:function(t,e){this.sizeStack.set(t,e),"INIT"===this.calcType?(this.calcSize.fixed=e,this.calcType="FIXED"):"FIXED"===this.calcType&&this.calcSize.fixed!==e&&(this.calcType="DYNAMIC",delete this.calcSize.fixed),"FIXED"!==this.calcType&&"undefined"!==this.calcSize.total&&(this.sizeStack.size<Math.min(this.keeps,this.uniqueKeys.length)?(this.calcSize.total=[].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(this.sizeStack.values())).reduce((function(t,e){return t+e}),0),this.calcSize.average=Math.round(this.calcSize.total/this.sizeStack.size)):delete this.calcSize.total)},onHeaderResized:function(t,e){this.calcSize.header=e},onFooterResized:function(t,e){this.calcSize.footer=e},handleSourceDataChange:function(){var t=Math.max(this.start,0);this.updateRange(this.start,this.getEndByStart(t))},updateSizeStack:function(){var t=this;this.sizeStack.forEach((function(e,i){t.uniqueKeys.includes(i)||t.sizeStack.delete(i)}))},checkRange:function(t,e){var i=this.keeps;this.uniqueKeys.length<=i?(t=0,e=this.uniqueKeyLen):e-t<i-1&&(t=e-i+1),this.start!==t&&this.updateRange(t,e)},updateRange:function(t,e){this.start=t,this.end=e,this.padding={front:this.getFront(),behind:this.getBehind()}},getScrollOvers:function(){var t=this.offset-this.calcSize.header;if(t<=0)return 0;if(this.isFixedType)return Math.floor(t/this.calcSize.fixed);for(var e=0,i=0,n=0,r=this.uniqueKeys.length;e<=r;){if(i=e+Math.floor((r-e)/2),(n=this.getOffsetByIndex(i))===t)return i;n<t?e=i+1:n>t&&(r=i-1)}return e>0?--e:0},getFront:function(){return this.isFixedType?this.calcSize.fixed*this.start:this.getOffsetByIndex(this.start)},getBehind:function(){var t=this.uniqueKeyLen;return this.isFixedType?(t-this.end)*this.calcSize.fixed:this.lastCalcIndex===t?this.getOffsetByIndex(t)-this.getOffsetByIndex(this.end):(t-this.end)*this.getItemSize()},getOffsetByIndex:function(t){if(!t)return 0;for(var e=0,i=0,n=0;n<t;n++)e+="number"==typeof(i=this.sizeStack.get(this.uniqueKeys[n]))?i:this.getItemSize();return this.lastCalcIndex=Math.max(this.lastCalcIndex,t-1),this.lastCalcIndex=Math.min(this.lastCalcIndex,this.uniqueKeyLen),e},getItemSize:function(){return this.isFixedType?this.calcSize.fixed:this.calcSize.average||this.size},getEndByStart:function(t){return Math.min(t+this.keeps,this.uniqueKeyLen)},uniqueId:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this.dataKey;return(Array.isArray(i)?i:i.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce((function(t,e){return(t||{})[e]}),t)||e}}}},,function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return r}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"virtualDragList",staticClass:"virtual-drag-list",style:{height:t.height,overflow:"hidden auto",position:"relative"},on:{scroll:function(e){return t.handleScroll(e)}}},[t.header?i("Slots",{attrs:{slots:t.header,tag:t.headerTag,uniqueKey:"header"},on:{resize:t.onHeaderResized}}):t._e(),t._v(" "),i("div",{ref:"content",style:{padding:t.padding.front+"px 0px "+t.padding.behind+"px"},attrs:{role:"group"}},t._l(t.visibleData,(function(e){return i("Items",{key:t.uniqueId(e),attrs:{tag:t.itemTag,source:e,index:t.getIndex(e),itemStyle:t.itemStyle,itemClass:t.itemClass,uniqueKey:t.uniqueId(e),dataSource:t.list,dragStyle:t.dragStyle},on:{resize:t.onItemResized},scopedSlots:t._u([{key:"item",fn:function(e){var i=e.source,n=e.index,r=e.uniqueKey;return[t._t("item",null,{source:i,index:n,dataKey:r})]}}],null,!0)})})),1),t._v(" "),t.footer?i("Slots",{attrs:{slots:t.footer,tag:t.footerTag,uniqueKey:"footer"},on:{resize:t.onFooterResized}}):t._e(),t._v(" "),i("div",{ref:"bottomItem"})],1)},r=[];n._withStripped=!0},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(6),s=(n=r)&&n.__esModule?n:{default:n};e.default=s.default},function(t,e,i){"use strict";i.r(e);var n=i(3),r=i(0);for(var s in r)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return r[t]}))}(s);var a=i(4),o=Object(a.a)(r.default,n.a,n.b,!1,null,null,null);o.options.__file="src/Virtual.vue",e.default=o.exports},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Slots=e.Items=void 0;var n,r=i(8),s=(n=r)&&n.__esModule?n:{default:n};function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var o={data:function(){return{observer:null,mask:null}},mounted:function(){var t=this;"undefined"!=typeof ResizeObserver&&(this.observer=new ResizeObserver((function(){t.onSizeChange()})),this.observer.observe(this.$el))},updated:function(){this.onSizeChange()},beforeDestroy:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},methods:{onSizeChange:function(){this.$emit("resize",this.uniqueKey,this.getCurrentSize())},getCurrentSize:function(){return this.$el?this.$el.offsetHeight:0},mousedown:function(t){var e=this;if(t.target.getAttribute("draggable")){var i=this.getTarget(t),n=i.target,r=i.item;this.$parent.dragState.oldNode=n,this.$parent.dragState.oldItem=r,this.setMask("init",t.clientX,t.clientY),document.onmousemove=function(t){t.preventDefault(),e.setMask("move",t.clientX,t.clientY);var i=e.getTarget(t),n=i.target,r=void 0===n?null:n,s=i.item,a=void 0===s?null:s;if(r&&a){document.body.style.cursor="grabbing",e.$parent.dragState.newNode=r,e.$parent.dragState.newIitem=a;var o=e.$parent.dragState,u=o.oldNode,l=o.newNode,d=o.oldItem,c=o.newIitem;if(d!=c){if(l&&l.animated)return;var h=e.dataSource.indexOf(d),f=e.dataSource.indexOf(c),g=u.getBoundingClientRect(),p=l.getBoundingClientRect();e.$parent.dragState.oldIndex=h,e.$parent.dragState.newIndex=f,h<f?l.parentNode.insertBefore(u,l.nextSibling):l.parentNode.insertBefore(u,l),e.animate(g,u),e.animate(p,l)}}else document.body.style.cursor="not-allowed"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,document.body.style.cursor="auto",e.setMask("destory");var t=e.$parent.dragState,i=t.oldItem,n=t.oldIndex,r=t.newIndex;if(n!=r){var s=[].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(e.dataSource));s.splice(n,1),s.splice(r,0,i),e.$parent.list=s,e.$parent.$emit("ondragend",s)}}}},setMask:function(t,e,i){if("init"==t){for(var n in this.mask=document.createElement("div"),this.dragStyle)this.mask.style[n]=this.dragStyle[n];this.mask.style.position="absolute",this.mask.style.left=e+"px",this.mask.style.top=i+"px",this.mask.innerHTML=this.$el.innerHTML,document.body.appendChild(this.mask)}else"move"==t?(this.mask.style.left=e+"px",this.mask.style.top=i+"px"):document.body.removeChild(this.mask)},getTarget:function(t){var e=this,i=t.target.getAttribute("data-key"),n=t.target;if(!i){if(n.contains(this.$el))return{};for(var r=t.target;(r=r.parentNode)&&r&&(n=r,i=r.getAttribute("data-key"),r!=document.documentElement&&!i););}return{target:n,item:this.dataSource.find((function(t){return e.$parent.uniqueId(t)==i}))}},animate:function(t,e){var i=this,n=e.getBoundingClientRect();1===t.nodeType&&(t=t.getBoundingClientRect()),this.setCss(e,"transition","none"),this.setCss(e,"transform","translate3d("+(t.left-n.left)+"px, "+(t.top-n.top)+"px, 0)"),e.offsetWidth,this.setCss(e,"transition","all 300ms"),this.setCss(e,"transform","translate3d(0, 0, 0)"),clearTimeout(e.animated),e.animated=setTimeout((function(){i.setCss(e,"transition",""),i.setCss(e,"transform",""),e.animated=!1}),300)},setCss:function(t,e,i){var n=t&&t.style;if(n){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];e in n||(e="-webkit-"+e),n[e]=i+("string"==typeof i?"":"px")}}}};e.Items=s.default.component("virtual-draglist-items",{mixins:[o],props:{tag:{},index:{},source:{},dragStyle:{},uniqueKey:{},itemStyle:{},itemClass:{},dataSource:{}},render:function(t){var e=this.tag,i=this.itemStyle,n=this.itemClass,r=this.source,s=this.index,o=this.uniqueKey;return t(e,{key:o,style:i,class:n,attrs:a({},"data-key",o),props:{source:r,index:s,uniqueKey:o},on:{mousedown:this.mousedown}},[this.$scopedSlots.item({source:r,index:s,uniqueKey:o})])}}),e.Slots=s.default.component("virtual-draglist-slots",{mixins:[o],props:{tag:{},slots:{},uniqueKey:{}},render:function(t){var e=this.tag,i=this.uniqueKey;return t(e,{key:i,attrs:{role:i}},this.slots)}})}])}));