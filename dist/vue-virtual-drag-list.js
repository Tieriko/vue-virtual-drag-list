!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("vue-virtual-drag-list",[],e):"object"==typeof exports?exports["vue-virtual-drag-list"]=e():t["vue-virtual-drag-list"]=e()}(window,function(){return function(u){function t(t){for(var e,i,n=t[0],r=t[1],s=t[2],a=0,o=[];a<n.length;a++)i=n[a],Object.prototype.hasOwnProperty.call(d,i)&&d[i]&&o.push(d[i][0]),d[i]=0;for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(u[e]=r[e]);for(h&&h(t);o.length;)o.shift()();return c.push.apply(c,s||[]),l()}function l(){for(var t,e=0;e<c.length;e++){for(var i=c[e],n=!0,r=1;r<i.length;r++){var s=i[r];0!==d[s]&&(n=!1)}n&&(c.splice(e--,1),t=a(a.s=i[0]))}return t}var i={},d={0:0},c=[];function a(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return u[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=u,a.c=i,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/dist/";var e=(n=window.webpackJsonpvue_virtual_drag_list=window.webpackJsonpvue_virtual_drag_list||[]).push.bind(n);n.push=t;for(var n=n.slice(),r=0;r<n.length;r++)t(n[r]);var h=e;return c.push([5,1]),l()}([function(t,e,i){"use strict";i.r(e);var n,r=i(1),s=i.n(r);for(n in r)["default"].indexOf(n)<0&&function(t){i.d(e,t,function(){return r[t]})}(n);e.default=s.a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i=i(7);e.default={name:"infinity-list",components:{Items:i.Items,Slots:i.Slots},props:{dataSource:{type:Array,default:function(){return[]}},dataKey:{type:String,required:!0},height:{type:String,default:"100%"},keeps:{type:Number,default:30},size:{type:Number},draggable:{type:Boolean,default:!0},headerTag:{type:String,default:"div"},footerTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},itemStyle:{type:Object,default:function(){}},itemClass:{type:String,default:""},dragStyle:{type:Object,default:function(){return{backgroundImage:"linear-gradient(to bottom, rgba(255, 255, 255, 0.1) 0%, rgba(0, 0, 0, 0.1) 40%, rgba(0, 0, 0, 0.1) 98%, #FFFFFF 100%)"}}}},data:function(){return{list:[],sizeStack:new Map,screenHeight:0,start:0,end:0,offset:0,direction:"",uniqueKeys:[],lastCalcIndex:0,calcType:"INIT",calcSize:{average:0,total:0,fixed:0,header:0,footer:0},padding:{front:0,behind:0},dragState:{oldNode:null,oldItem:null,oldIndex:null,newNode:null,newIitem:null,newIndex:null}}},computed:{visibleData:function(){return this.list.slice(this.start,this.end)},getIndex:function(){return function(e){var i=this;return this.list.findIndex(function(t){return i.uniqueId(e)==i.uniqueId(t)})}},uniqueKeyLen:function(){return this.uniqueKeys.length-1},isFixedType:function(){return"FIXED"===this.calcType}},watch:{dataSource:{handler:function(t){var e=this;this.list=JSON.parse(JSON.stringify(t)),this.uniqueKeys=this.list.map(function(t){return e.uniqueId(t)}),this.handleSourceDataChange(),this.updateSizeStack()},deep:!0,immediate:!0}},beforeCreate:function(){var t=this.$slots,e=t.header,t=t.footer;this.header=e,this.footer=t},mounted:function(){this.screenHeight=Math.ceil(this.$el.clientHeight),this.end=this.start+this.keeps},methods:{scrollToBottom:function(){var t=this,e=this.$refs,i=e.bottomItem,e=e.virtualDragList;i&&(i=i.offsetTop,this.scrollToOffset(i));var n=this.$el.clientHeight,r=e.scrollTop,s=e.scrollHeight;setTimeout(function(){r+n<s&&t.scrollToBottom()},10)},scrollToOffset:function(t){this.$refs.virtualDragList.scrollTop=t},scrollToIndex:function(t){t>=this.list.length-1?this.scrollToBottom():(t=this.getOffsetByIndex(t),this.scrollToOffset(t))},handleScroll:function(t){var e=this.$refs.virtualDragList,i=Math.ceil(this.$el.clientHeight),n=Math.ceil(e.scrollTop),r=Math.ceil(e.scrollHeight);n<0||r+1<n+i||!r||(this.direction=n<this.offset?"FRONT":"BEHIND",this.offset=n,e=this.getScrollOvers(),"FRONT"===this.direction?(this.handleFront(e),this.list.length&&n<=0&&this.$emit("top")):"BEHIND"===this.direction&&(this.handleBehind(e),r<=i+n&&this.$emit("bottom")))},handleFront:function(t){t>this.start||(t=Math.max(t-Math.round(this.keeps/3),0),this.checkRange(t,this.getEndByStart(t)))},handleBehind:function(t){t<this.start+Math.round(this.keeps/3)||this.checkRange(t,this.getEndByStart(t))},onItemResized:function(t,e){this.sizeStack.set(t,e),"INIT"===this.calcType?(this.calcSize.fixed=e,this.calcType="FIXED"):"FIXED"===this.calcType&&this.calcSize.fixed!==e&&(this.calcType="DYNAMIC",delete this.calcSize.fixed),"FIXED"!==this.calcType&&"undefined"!==this.calcSize.total&&(this.sizeStack.size<Math.min(this.keeps,this.uniqueKeys.length)?(this.calcSize.total=[].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(this.sizeStack.values())).reduce(function(t,e){return t+e},0),this.calcSize.average=Math.round(this.calcSize.total/this.sizeStack.size)):delete this.calcSize.total)},onHeaderResized:function(t,e){this.calcSize.header=e},onFooterResized:function(t,e){this.calcSize.footer=e},handleSourceDataChange:function(){var t=Math.max(this.start,0);this.updateRange(this.start,this.getEndByStart(t))},updateSizeStack:function(){var i=this;this.sizeStack.forEach(function(t,e){i.uniqueKeys.includes(e)||i.sizeStack.delete(e)})},checkRange:function(t,e){var i=this.keeps;this.uniqueKeys.length<=i?(t=0,e=this.uniqueKeyLen):e-t<i-1&&(t=e-i+1),this.start!==t&&this.updateRange(t,e)},updateRange:function(t,e){this.start=t,this.end=e,this.padding={front:this.getFront(),behind:this.getBehind()}},getScrollOvers:function(){var t=this.offset-this.calcSize.header;if(t<=0)return 0;if(this.isFixedType)return Math.floor(t/this.calcSize.fixed);for(var e,i,n=0,r=this.uniqueKeys.length;n<=r;){if(e=n+Math.floor((r-n)/2),(i=this.getOffsetByIndex(e))===t)return e;i<t?n=e+1:t<i&&(r=e-1)}return 0<n?--n:0},getFront:function(){return this.isFixedType?this.calcSize.fixed*this.start:this.getOffsetByIndex(this.start)},getBehind:function(){var t=this.uniqueKeyLen;return this.isFixedType?(t-this.end)*this.calcSize.fixed:this.lastCalcIndex===t?this.getOffsetByIndex(t)-this.getOffsetByIndex(this.end):(t-this.end)*this.getItemSize()},getOffsetByIndex:function(t){if(!t)return 0;for(var e,i=0,n=0;n<t;n++)i+="number"==typeof(e=this.sizeStack.get(this.uniqueKeys[n]))?e:this.getItemSize();return this.lastCalcIndex=Math.max(this.lastCalcIndex,t-1),this.lastCalcIndex=Math.min(this.lastCalcIndex,this.uniqueKeyLen),i},getItemSize:function(){return this.isFixedType?this.calcSize.fixed:this.calcSize.average||this.size},getEndByStart:function(t){return Math.min(t+this.keeps,this.uniqueKeyLen)},uniqueId:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=this.dataKey;return(Array.isArray(i)?i:i.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce(function(t,e){return(t||{})[e]},t)||e}}}},,function(t,e,i){"use strict";i.d(e,"a",function(){return n}),i.d(e,"b",function(){return r});var n=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{ref:"virtualDragList",staticClass:"virtual-drag-list",style:{height:n.height,overflow:"hidden auto",position:"relative"},on:{scroll:function(t){return n.handleScroll(t)}}},[n.header?e("Slots",{attrs:{slots:n.header,tag:n.headerTag,uniqueKey:"header"},on:{resize:n.onHeaderResized}}):n._e(),n._v(" "),e("div",{ref:"content",style:{padding:n.padding.front+"px 0px "+n.padding.behind+"px"},attrs:{role:"group"}},n._l(n.visibleData,function(t){return e("Items",{key:n.uniqueId(t),attrs:{tag:n.itemTag,source:t,index:n.getIndex(t),itemStyle:n.itemStyle,itemClass:n.itemClass,uniqueKey:n.uniqueId(t),dataSource:n.list,dragStyle:n.dragStyle},on:{resize:n.onItemResized},scopedSlots:n._u([{key:"item",fn:function(t){var e=t.source,i=t.index,t=t.uniqueKey;return[n._t("item",null,{source:e,index:i,dataKey:t})]}}],null,!0)})}),1),n._v(" "),n.footer?e("Slots",{attrs:{slots:n.footer,tag:n.footerTag,uniqueKey:"footer"},on:{resize:n.onFooterResized}}):n._e(),n._v(" "),e("div",{ref:"bottomItem"})],1)},r=[];n._withStripped=!0},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=i(6),i=(i=i)&&i.__esModule?i:{default:i};e.default=i.default},function(t,e,i){"use strict";i.r(e);var n,r=i(3),s=i(0);for(n in s)["default"].indexOf(n)<0&&function(t){i.d(e,t,function(){return s[t]})}(n);var a=i(4),r=Object(a.a)(s.default,r.a,r.b,!1,null,null,null);r.options.__file="src/Virtual.vue",e.default=r.exports},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Slots=e.Items=void 0;var n=i(8),n=(i=n)&&i.__esModule?i:{default:i};i={data:function(){return{observer:null,mask:null}},mounted:function(){var t=this;"undefined"!=typeof ResizeObserver&&(this.observer=new ResizeObserver(function(){t.onSizeChange()}),this.observer.observe(this.$el))},updated:function(){this.onSizeChange()},beforeDestroy:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},methods:{onSizeChange:function(){this.$emit("resize",this.uniqueKey,this.getCurrentSize())},getCurrentSize:function(){return this.$el?this.$el.offsetHeight:0},mousedown:function(t){var e,i,a=this;t.target.getAttribute("draggable")&&(e=(i=this.getTarget(t)).target,i=i.item,this.$parent.dragState.oldNode=e,this.$parent.dragState.oldItem=i,this.setMask("init",t.clientX,t.clientY),document.onmousemove=function(t){t.preventDefault(),a.setMask("move",t.clientX,t.clientY);var e=a.getTarget(t),i=e.target,n=void 0===i?null:i,r=e.item,s=void 0===r?null:r;n&&s?(document.body.style.cursor="grabbing",a.$parent.dragState.newNode=n,a.$parent.dragState.newIitem=s,i=(t=a.$parent.dragState).oldNode,e=t.newNode,(r=t.oldItem)!=(n=t.newIitem)&&(e&&e.animated||(s=a.dataSource.indexOf(r),t=a.dataSource.indexOf(n),r=i.getBoundingClientRect(),n=e.getBoundingClientRect(),(a.$parent.dragState.oldIndex=s)<(a.$parent.dragState.newIndex=t)?e.parentNode.insertBefore(i,e.nextSibling):e.parentNode.insertBefore(i,e),a.animate(r,i),a.animate(n,e)))):document.body.style.cursor="not-allowed"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,document.body.style.cursor="auto",a.setMask("destory");var t=a.$parent.dragState,e=t.oldItem,i=t.oldIndex,n=t.newIndex;i!=n&&((t=[].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(a.dataSource))).splice(i,1),t.splice(n,0,e),a.$parent.list=t,a.$parent.$emit("ondragend",t))})},setMask:function(t,e,i){if("init"==t){for(var n in this.mask=document.createElement("div"),this.dragStyle)this.mask.style[n]=this.dragStyle[n];this.mask.style.position="absolute",this.mask.style.left=e+"px",this.mask.style.top=i+"px",this.mask.innerHTML=this.$el.innerHTML,document.body.appendChild(this.mask)}else"move"==t?(this.mask.style.left=e+"px",this.mask.style.top=i+"px"):document.body.removeChild(this.mask)},getTarget:function(t){var e=this,i=t.target.getAttribute("data-key"),n=t.target;if(!i){if(n.contains(this.$el))return{};for(var r=t.target;(r=r.parentNode)&&r&&(i=(n=r).getAttribute("data-key"),r!=document.documentElement&&!i););}return{target:n,item:this.dataSource.find(function(t){return e.$parent.uniqueId(t)==i})}},animate:function(t,e){var i=this,n=e.getBoundingClientRect();1===t.nodeType&&(t=t.getBoundingClientRect()),this.setCss(e,"transition","none"),this.setCss(e,"transform","translate3d("+(t.left-n.left)+"px, "+(t.top-n.top)+"px, 0)"),e.offsetWidth,this.setCss(e,"transition","all 300ms"),this.setCss(e,"transform","translate3d(0, 0, 0)"),clearTimeout(e.animated),e.animated=setTimeout(function(){i.setCss(e,"transition",""),i.setCss(e,"transform",""),e.animated=!1},300)},setCss:function(t,e,i){var n=t&&t.style;if(n){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];n[e=!(e in n)?"-webkit-"+e:e]=i+("string"==typeof i?"":"px")}}}};e.Items=n.default.component("virtual-draglist-items",{mixins:[i],props:{tag:{},index:{},source:{},dragStyle:{},uniqueKey:{},itemStyle:{},itemClass:{},dataSource:{}},render:function(t){var e=this.tag,i=this.itemStyle,n=this.itemClass,r=this.source,s=this.index,a=this.uniqueKey;return t(e,{key:a,style:i,class:n,attrs:(e=a,(i="data-key")in(n={})?Object.defineProperty(n,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[i]=e,n),props:{source:r,index:s,uniqueKey:a},on:{mousedown:this.mousedown}},[this.$scopedSlots.item({source:r,index:s,uniqueKey:a})])}}),e.Slots=n.default.component("virtual-draglist-slots",{mixins:[i],props:{tag:{},slots:{},uniqueKey:{}},render:function(t){var e=this.tag,i=this.uniqueKey;return t(e,{key:i,attrs:{role:i}},this.slots)}})}])});