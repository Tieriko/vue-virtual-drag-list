!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).VirtualDragList=e(t.Vue)}(this,function(F){"use strict";function t(i,o=50,n=!1){let r,s;function t(...t){var e;return r&&clearTimeout(r),n?(e=!r,r=setTimeout(()=>{r=null},o),e&&(s=i.apply(this,t))):r=setTimeout(()=>{i.apply(this,t)},o),s}return t.prototype.cancel=function(){clearTimeout(r),r=null},t}var s,a,l,e,o,n,r,h,c,d,u,f,g;function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function v(t,e,i){return e&&m(t.prototype,e),i&&m(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function y(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return S(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?S(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=new Array(e);i<e;i++)o[i]=t[i];return o}function b(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}function w(e,i){i?"none"===i?r.forEach(function(t){return O(e,t,"none")}):r.forEach(function(t){return O(e,t,"".concat(t.split("transition")[0],"transform ").concat(i))}):r.forEach(function(t){return O(e,t,"")})}function E(e,i){i?h.forEach(function(t){return O(e,t,"".concat(t.split("transform")[0]).concat(i))}):h.forEach(function(t){return O(e,t,"")})}function x(t){var e=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,t=e||t;return{touch:e,e:t,target:e?document.elementFromPoint(t.clientX,t.clientY):t.target}}function D(t,e,i){window.addEventListener?t.addEventListener(e,i,!(!c&&s)&&o):window.attachEvent&&t.attachEvent("on"+e,i)}function T(t,e,i){window.removeEventListener?t.removeEventListener(e,i,!(!c&&s)&&o):window.detachEvent&&t.detachEvent("on"+e,i)}function I(t){var e={top:0,left:0,height:0,width:0};e.height=t.offsetHeight,e.width=t.offsetWidth,e.top=t.offsetTop,e.left=t.offsetLeft;for(var i=t.offsetParent;null!==i;)e.top+=i.offsetTop,e.left+=i.offsetLeft,i=i.offsetParent;return e}function _(t,e){if(!t||!t.getBoundingClientRect)return z();var i=t,o=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var n=O(i);if(i.clientWidth<i.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!i.getBoundingClientRect||i===document.body)return z();if(o||e)return i;o=!0}}}while(i=i.parentNode);return z()}function z(){var t=document.scrollingElement;return!t||t.contains(document.body)?document:t}function k(t){if(t.getBoundingClientRect||t===window){var e={top:0,left:0,bottom:0,right:0,height:0,width:0};return t!==window&&t.parentNode&&t!==z()?(t=t.getBoundingClientRect(),e.top=t.top,e.left=t.left,e.bottom=t.bottom,e.right=t.right,e.height=t.height,e.width=t.width):(e.top=0,e.left=0,e.bottom=window.innerHeight,e.right=window.innerWidth,e.height=window.innerHeight,e.width=window.innerWidth),e}}function C(t,e,i){var o=y(Array.from(t.children)),t=o.indexOf(e);if(-1<t)return i?o[t]:{index:t,el:o[t],rect:k(o[t]),offset:I(o[t])};for(var n=0;n<o.length;n++)if(function(t,e){var i;if(t&&e)for(i=t.parentNode;i;){if(e===i)return!0;i=i.parentNode}return!1}(e,o[n]))return i?o[n]:{index:n,el:o[n],rect:k(o[n]),offset:I(o[n])};return i?null:{index:-1,el:null,rect:{},offset:{}}}function M(t,e,i){var o;t&&e&&(t.classList?t.classList[i?"add":"remove"](e):(o=(" "+t.className+" ").replace(n," ").replace(" "+e+" "," "),t.className=(o+(i?" "+e:"")).replace(n," ")))}function O(t,e,i){var o=t&&t.style;if(o){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];o[e=!(e in o||-1!==e.indexOf("webkit"))?"-webkit-"+e:e]=i+("string"==typeof i?"":"px")}}function $(i,o,n){var r=null;return function(){var t=this,e=arguments;r&&clearTimeout(r),n&&!r&&i.apply(t,e),r=setTimeout(function(){i.apply(t,e)},o)}}function A(i,o){var n=null;return function(){var t=this,e=arguments;n=n||setTimeout(function(){n=null,i.apply(t,e)},o)}}function B(){var n=[];return{captureAnimationState:function(){var t,e=y(Array.from(this.rootEl.children)),i=(t=e,o=this.dragEl,i=this.dropEl,o=t.indexOf(o),i=t.indexOf(i),o<i?{start:o,end:i}:{start:i,end:o}),o=i.start,i=i.end;n.length=0,e.slice(o,i+1).forEach(function(t){n.push({target:t,rect:k(t)})})},animateRange:function(){var i=this;n.forEach(function(t){var e=t.target,t=t.rect;i.animate(e,t,i.options.animation)})},animate:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:150,o=k(t),n=e.left-o.left,o=e.top-o.top;w(t,"none"),E(t,"translate3d(".concat(n,"px, ").concat(o,"px, 0)")),t.offsetLeft,w(t,"".concat(i,"ms")),E(t,"translate3d(0px, 0px, 0px)"),clearTimeout(t.animated),t.animated=setTimeout(function(){w(t,""),E(t,""),t.animated=null},i)}}}function L(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.rootEl=t,this.scrollEl=_(t,!0),this.options=e=Object.assign({},e),this.ownerDocument=t.ownerDocument;var i,o={autoScroll:!0,scrollStep:5,scrollThreshold:15,delay:0,delayOnTouchOnly:!1,disabled:!1,animation:150,ghostAnimation:0,ghostClass:"",ghostStyle:{},chosenClass:"",draggable:void 0,dragging:void 0,onDrag:void 0,onMove:void 0,onDrop:void 0,onChange:void 0,fallbackOnBody:!1,forceFallback:!1,stopPropagation:!1,supportPointer:"PointerEvent"in window&&!l,supportTouch:"ontouchstart"in window};for(i in o)i in this.options||(this.options[i]=o[i]);this.container=this.options.fallbackOnBody?document.body:this.rootEl,this.nativeDraggable=!this.options.forceFallback&&g,this.move={x:0,y:0},this.state=new d,this.differ=new u,this.ghost=new f(this),this.dragEl=null,this.dropEl=null,this.dragStartTimer=null,this.autoScrollTimer=null,Object.assign(this,{_bindEventListener:function(){this._onDrag=this._onDrag.bind(this),this._onMove=this._onMove.bind(this),this._onDrop=this._onDrop.bind(this);var t=this.options,e=t.supportPointer,t=t.supportTouch;D(this.rootEl,e?"pointerdown":t?"touchstart":"mousedown",this._onDrag)},_clearEvent:function(){T(this.rootEl,"pointerdown",this._onDrag),T(this.rootEl,"touchstart",this._onDrag),T(this.rootEl,"mousedown",this._onDrag)},_bindMoveEvents:function(t){this.options.supportPointer?D(this.ownerDocument,"pointermove",this._onMove):D(this.ownerDocument,t?"touchmove":"mousemove",this._onMove)},_unbindMoveEvents:function(){T(this.ownerDocument,"pointermove",this._onMove),T(this.ownerDocument,"touchmove",this._onMove),T(this.ownerDocument,"mousemove",this._onMove)},_unbindDropEvents:function(){T(this.ownerDocument,"pointerup",this._onDrop),T(this.ownerDocument,"pointercancel",this._onDrop),T(this.ownerDocument,"touchend",this._onDrop),T(this.ownerDocument,"touchcancel",this._onDrop),T(this.ownerDocument,"mouseup",this._onDrop)},_unbindDragEvents:function(){this.nativeDraggable&&(T(this.rootEl,"dragstart",this._onDragStart),T(this.rootEl,"dragover",this._onDragOver),T(this.rootEl,"dragend",this._onDrop))}},B(),(window.requestAnimationFrame||(window.requestAnimationFrame=function(t){return setTimeout(t,17)}),{_autoScroll:A(function(t){var e,i,o,n,r,s,a,l,h,c,d,u,f,g,p;t.state.sortableDown&&t.state.sortableMove&&(f=(h=t.state.sortableMove).clientX,e=h.clientY,void 0!==f&&void 0!==e&&(t.scrollEl===t.ownerDocument||(i=(d=t.scrollEl).scrollTop,o=d.scrollLeft,n=d.scrollHeight,r=d.scrollWidth,s=(c=k(t.scrollEl)).top,a=c.right,g=c.bottom,u=c.left,l=c.height,h=c.width,c=(d=t.options).scrollStep,d=d.scrollThreshold,u=0<o&&u<=f&&f<=u+d,f=o+h<r&&f<=a&&a-d<=f,g=i+l<n&&e<=g&&g-d<=e,p={x:o,y:i},(d=0<i&&s<=e&&e<=s+d)?(p.x=u?o-c:f?o+c:o,p.y=i-c):g?(p.x=u?o-c:f?o+c:o,p.y=i+c):u?(p.x=o-c,p.y=i):f&&(p.x=o+c,p.y=i),(d||u||f||g)&&requestAnimationFrame(function(){t.scrollEl.scrollTo(p.x,p.y),t._autoScroll(t)}))))},10)})),this._bindEventListener()}var N=(s=b(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),a=b(/Edge/i),l=b(/safari/i)&&!b(/chrome/i)&&!b(/android/i),W=b(/iP(ad|od|hone)/i),e=b(/chrome/i)&&b(/android/i),o={capture:!1,passive:!1},n=/\s+/g,r=["-webkit-transition","-moz-transition","-ms-transition","-o-transition","transition"],h=["-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform"],c=function(){var t=!1;return document.addEventListener("checkIfSupportPassive",null,{get passive(){return t=!0}}),t}(),d=v(function t(){i(this,t),this.sortableDown=void 0,this.sortableMove=void 0,this.animationEnd=void 0}),u=function(){function t(){i(this,t),this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}return v(t,[{key:"get",value:function(t){return this[t]}},{key:"set",value:function(t,e){this[t]=e}},{key:"destroy",value:function(){this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}}]),t}(),f=function(){function e(t){i(this,e),this.$el=null,this.distance={x:0,y:0},this.options=t.options,this.container=t.container}return v(e,[{key:"init",value:function(t,e){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];this.$el=t;var o=this.options,t=o.ghostClass,o=o.ghostStyle,o=void 0===o?{}:o;M(this.$el,t,!0),O(this.$el,"box-sizing","border-box"),O(this.$el,"margin",0),O(this.$el,"top",e.top),O(this.$el,"left",e.left),O(this.$el,"width",e.width),O(this.$el,"height",e.height),O(this.$el,"opacity","0.8"),O(this.$el,"position","fixed"),O(this.$el,"zIndex","100000"),O(this.$el,"pointerEvents","none"),this.setStyle(o),w(this.$el,"none"),E(this.$el,"translate3d(0px, 0px, 0px)"),i&&this.container.appendChild(this.$el),O(this.$el,"transform-origin",this.distance.x/parseInt(this.$el.style.width)*100+"% "+this.distance.y/parseInt(this.$el.style.height)*100+"%")}},{key:"setStyle",value:function(t){for(var e in t)O(this.$el,e,t[e])}},{key:"rect",value:function(){return k(this.$el)}},{key:"move",value:function(t,e){this.$el&&(w(this.$el,2<arguments.length&&void 0!==arguments[2]&&arguments[2]?"".concat(this.options.ghostAnimation,"ms"):"none"),E(this.$el,"translate3d(".concat(t,"px, ").concat(e,"px, 0)")))}},{key:"destroy",value:function(t){var e,i,o=this;this.$el&&(e=parseInt(this.$el.style.left),i=parseInt(this.$el.style.top),this.move(t.left-e,t.top-i,!0),(i=this.options.ghostAnimation)?setTimeout(function(){return o.clear()},i):this.clear())}},{key:"clear",value:function(){this.$el&&this.$el.remove(),this.distance={x:0,y:0},this.$el=null}}]),e}(),g="undefined"!=typeof document&&!e&&!W&&"draggable"in document.createElement("div"),(L.prototype={constructor:L,destroy:function(){this._clearState(),this._clearEvent(),Array.prototype.forEach.call(this.rootEl.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")})},set:function(t,e){this.options[t]=e},get:function(t){return this.options[t]},_onDrag:function(t){var e=this;if(!(/mousedown|pointerdown/.test(t.type)&&0!==t.button||this.options.disabled)){var i=x(t),o=i.touch,n=i.e,r=i.target;if(this.nativeDraggable||!l||!r||"SELECT"!==r.tagName.toUpperCase()){if(r===this.rootEl)return!0;this.options.stopPropagation&&t.stopPropagation();i=this.options,t=i.draggable,i=i.dragging;if("function"==typeof t){if(!t(n))return!0}else if("string"==typeof t){if(!function(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}(r,t))return!0}else if(void 0!==t)throw new Error('draggable expected "function" or "string" but received "'.concat(p(t),'"'));if(i){if("function"!=typeof i)throw new Error('dragging expected "function" or "string" but received "'.concat(p(i),'"'));this.dragEl=i(n)}else this.dragEl=C(this.rootEl,r,!0);if(!this.dragEl||this.dragEl.animated)return!0;o&&(this.dragEl.style["touch-action"]="none");i=C(this.rootEl,this.dragEl),r=i.rect,i=i.offset;this.move={x:n.clientX,y:n.clientY},this.differ.from={node:this.dragEl,rect:r,offset:i},this.ghost.distance={x:n.clientX-r.left,y:n.clientY-r.top},this.state.sortableDown=n,D(this.ownerDocument,"pointerup",this._onDrop),D(this.ownerDocument,"touchend",this._onDrop),D(this.ownerDocument,"mouseup",this._onDrop);i=this.options,r=i.delay,i=i.delayOnTouchOnly;!r||i&&!o||this.nativeDraggable&&(a||s)?this._onStart(n,o):(clearTimeout(this.dragStartTimer),this.dragStartTimer=setTimeout(function(){return e._onStart(n,o)},r))}}},_onStart:function(t,e){!this.nativeDraggable||e?(this._bindMoveEvents(e),D(this.ownerDocument,"pointercancel",this._onDrop),D(this.ownerDocument,"touchcancel",this._onDrop)):(this.dragEl.draggable=!0,this._onDragStart=this._onDragStart.bind(this),this._onDragOver=this._onDragOver.bind(this),D(this.rootEl,"dragstart",this._onDragStart));try{document.selection?setTimeout(function(){document.selection.empty()},0):window.getSelection().removeAllRanges()}catch(t){}},_onDragStart:function(t){t.dataTransfer.setData("te",t.target.innerText),D(this.rootEl,"dragover",this._onDragOver),D(this.rootEl,"dragend",this._onDrop)},_onDragOver:function(t){var e,i,o,n;this.state.sortableDown&&(this.options.stopPropagation&&t.stopPropagation&&t.stopPropagation(),void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),e=t.clientX,i=t.clientY,o=e-this.move.x,n=i-this.move.y,void 0!==e&&Math.abs(o)<=0&&void 0!==i&&Math.abs(n)<=0||(this._onStarted(t,t),t.target!==this.rootEl&&this._onChange(this,t.target,t,t)))},_onMove:function(t){var e,i,o,n,r,s,a,l,h=this;this.state.sortableDown&&(e=(r=x(t)).e,i=r.target,o=e.clientX,n=e.clientY,s=o-this.move.x,a=n-this.move.y,void 0!==o&&Math.abs(s)<=0&&void 0!==n&&Math.abs(a)<=0||(this.options.stopPropagation&&t.stopPropagation&&t.stopPropagation(),void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),this._onStarted(e,t),this.ghost.move(s,a),(l=this.options.onMove)&&"function"==typeof l&&l(this.differ.from,this.ghost.$el,e,t),o<0||n<0||(s=(r=k(this.rootEl)).top,a=r.right,l=r.bottom,o<r.left||a<o||n<s||l<n||(this._onChange(this,i,e,t),this.autoScrollTimer&&clearTimeout(this.autoScrollTimer),this.options.autoScroll&&(this.autoScrollTimer=setTimeout(function(){return h._autoScroll(h)},0))))))},_onStarted:function(t,e){var i;this.state.sortableMove=t,this.ghost.$el||((i=this.options.onDrag)&&"function"==typeof i&&i(this.dragEl,t,e),t=this.differ.from.rect,e=this.dragEl.cloneNode(!0),this.ghost.init(e,t,!this.nativeDraggable),M(this.dragEl,this.options.chosenClass,!0),this.dragEl.style["will-change"]="transform",l&&O(document.body,"user-select","none"),this.nativeDraggable&&this._unbindDropEvents())},_onChange:$(function(t,e,i,o){var n,r,s,a,l=C(t.rootEl,e),h=l.el,c=l.rect,d=l.offset;h&&!h.animated&&(t.dropEl=h,n=i.clientX,r=i.clientY,s=c.left,a=c.right,e=c.top,l=c.bottom,s<n&&n<a&&e<r&&r<l&&h!==t.dragEl&&(t.differ.to={node:t.dropEl,rect:c,offset:d},t.captureAnimationState(),l=t.options.onChange,c=I(t.dragEl),l&&"function"==typeof l&&l(t.differ.from,t.differ.to,i,o),c.top<d.top||c.left<d.left?t.rootEl.insertBefore(t.dragEl,h.nextElementSibling):t.rootEl.insertBefore(t.dragEl,h),t.animateRange()))},5),_onDrop:function(t){this._unbindDragEvents(),this._unbindMoveEvents(),this._unbindDropEvents(),this.dragStartTimer&&clearTimeout(this.dragStartTimer),this.options.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var e,i=x(t).touch;M(this.dragEl,this.options.chosenClass,!1),this.nativeDraggable&&(this.dragEl.draggable=!1),i&&(this.dragEl.style["touch-action"]=""),this.dragEl.style["will-change"]="",this.state.sortableDown&&this.state.sortableMove&&(this.differ.to.offset=I(this.dragEl),this.differ.to.rect=k(this.dragEl),i=(e=this.differ).from,e=e.to,i=i.offset.top!==e.offset.top||i.offset.left!==e.offset.left,(e=this.options.onDrop)&&"function"==typeof e&&e(i,t)),l&&O(document.body,"user-select",""),this.ghost.destroy(this.differ.to.rect),this.state=new d},_clearState:function(){this.state=new d,this.differ.destroy(),this.dragEl=null,this.dropEl=null}}).utils={getRect:k,getOffset:I,debounce:$,throttle:A,getParentAutoScrollElement:_},L);class H{from;to;constructor(){this.from={key:void 0,item:void 0,index:-1},this.to={key:void 0,item:void 0,index:-1}}}class K{onDrag;onDrop;dragState;dragElement;drag;options;dataSource;cloneList;rangeIsChanged;constructor(t,e,i){this.options=t,this.onDrag=e,this.onDrop=i,this.dataSource=t.dataSource,this.cloneList=new Array,this.dragState=new H,this.rangeIsChanged=!1,t.scrollEl&&this.init()}set(t,e){this[t]=e,"dataSource"===t&&this.dragElement&&this.dragStart(this.dragElement,!1)}setOption(t,e){this.options[t]=e,this.drag.set(t,e)}init(){var{disabled:t,draggable:e,ghostClass:i,ghostStyle:o,chosenClass:n,animation:r,autoScroll:s,scrollStep:a,scrollThreshold:l}=this.options;this.drag=new N(this.options.scrollEl,{disabled:t,draggable:e,ghostClass:i,ghostStyle:o,chosenClass:n,animation:r,autoScroll:s,scrollStep:a,scrollThreshold:l,onChange:(t,e)=>this.onChange(t,e),onDrag:t=>this.dragStart(t),onDrop:t=>this.dragEnd(t)})}dragStart(t,e=!0){this.dragElement=t,this.cloneList=[...this.dataSource];const i=t.getAttribute("data-key");this.dataSource.forEach((t,e)=>{this.options.getKey(t)==i&&(this.dragState.from={item:t,index:e,key:i})}),e?(this.rangeIsChanged=!1,this.onDrag(this.dragState.from,t)):this.rangeIsChanged=!0}onChange(t,e){const o=this.dragState.from.key,n=e.node.getAttribute("data-key"),r={item:null,index:-1},s={item:null,index:-1};this.cloneList.forEach((t,e)=>{var i=this.options.getKey(t);i==o&&Object.assign(r,{item:t,index:e}),i==n&&Object.assign(s,{item:t,index:e})}),this.cloneList.splice(r.index,1),this.cloneList.splice(s.index,0,r.item)}dragEnd(t){const i=this.options["getKey"];this.rangeIsChanged&&this.dragElement&&this.dragElement.remove();const o=this.dragState["from"];this.cloneList.forEach((t,e)=>{i(t)==o.key&&(this.dragState.to={index:e,key:i(this.dataSource[e]),item:this.dataSource[e]})}),this.onDrop(this.cloneList,o,this.dragState.to,t),this.dataSource=[...this.cloneList],this.clear()}clear(){this.dragElement=null,this.rangeIsChanged=!1,this.dragState=new H}destroy(){this.drag&&this.drag.destroy(),this.drag=null}}class P{start;end;front;behind;constructor(t={}){this.start=t.start||0,this.end=t.end||0,this.front=t.front||0,this.behind=t.behind||0}}class R{average;total;fixed;header;footer;constructor(){this.average=0,this.total=0,this.fixed=0,this.header=0,this.footer=0}}const q={INIT:"INIT",FIXED:"FIXED",DYNAMIC:"DYNAMIC"},U={FRONT:"FRONT",BEHIND:"BEHIND"};class j{options;callback;sizes;isHorizontal;calcIndex;calcType;calcSize;range;direction;offset;constructor(t,e){this.options={...t},this.callback=e,this.sizes=new Map,this.isHorizontal=t.isHorizontal,this.calcIndex=0,this.calcType=q.INIT,this.calcSize=new R,this.direction="",this.offset=0,this.range=Object.create(null),t&&this.checkIfUpdate(0,t.keeps-1)}updateUniqueKeys(t){this.options.uniqueKeys=t}updateSizes(i){this.sizes.forEach((t,e)=>{i.includes(e)||this.sizes.delete(e)})}updateRange(){var t=Math.max(this.range.start,0),e=Math.min(this.options.keeps,this.options.uniqueKeys.length);this.sizes.size>=e-2?this.handleUpdate(t,this.getEndByStart(t)):window.requestAnimationFrame?window.requestAnimationFrame(()=>this.updateRange()):setTimeout(()=>this.updateRange(),3)}handleScroll(t){this.direction=t<this.offset?U.FRONT:U.BEHIND,this.offset=t;t=this.getScrollItems(t);this.isFront()?this.handleScrollFront(t):this.isBehind()&&this.handleScrollBehind(t)}isFront(){return this.direction===U.FRONT}isBehind(){return this.direction===U.BEHIND}isFixed(){return this.calcType===q.FIXED}getScrollItems(t){var{fixed:e,header:i}=this.calcSize;if(i&&(t-=i),t<=0)return 0;if(this.isFixed())return Math.floor(t/e);let o=0,n=this.options.uniqueKeys.length;for(var r,s;o<=n;){if(r=o+Math.floor((n-o)/2),(s=this.getOffsetByIndex(r))===t)return r;s<t?o=r+1:t<s&&(n=r-1)}return 0<o?--o:0}handleScrollFront(t){t>this.range.start||(t=Math.max(t-Math.round(this.options.keeps/3),0),this.checkIfUpdate(t,this.getEndByStart(t)))}handleScrollBehind(t){t<this.range.start+Math.round(this.options.keeps/3)||this.checkIfUpdate(t,this.getEndByStart(t))}checkIfUpdate(t,e){var{uniqueKeys:i,keeps:o}=this.options;i.length<=o?(t=0,e=i.length-1):e-t<o-1&&(t=e-o+1),this.range.start!==t&&this.handleUpdate(t,e)}handleUpdate(t,e){this.range.start=t,this.range.end=e,this.range.front=this.getFrontOffset(),this.range.behind=this.getBehindOffset(),this.callback({...this.range})}getFrontOffset(){return this.isFixed()?this.calcSize.fixed*this.range.start:this.getOffsetByIndex(this.range.start)}getBehindOffset(){var t=this.getLastIndex();return this.isFixed()?(t-this.range.end)*this.calcSize.fixed:this.calcIndex===t?this.getOffsetByIndex(t)-this.getOffsetByIndex(this.range.end):(t-this.range.end)*this.getItemSize()}getOffsetByIndex(e){if(!e)return 0;let i=0;for(let t=0;t<e;t++){var o=this.sizes.get(this.options.uniqueKeys[t]);i+="number"==typeof o?o:this.getItemSize()}return this.calcIndex=Math.max(this.calcIndex,e-1),this.calcIndex=Math.min(this.calcIndex,this.getLastIndex()),i}getEndByStart(t){return Math.min(t+this.options.keeps-1,this.getLastIndex())}getLastIndex(){var{uniqueKeys:t,keeps:e}=this.options;return 0<t.length?t.length-1:e-1}getItemSize(){return this.isFixed()?this.calcSize.fixed:this.calcSize.average||this.options.size}handleItemSizeChange(t,e){this.sizes.set(t,e),this.calcType===q.INIT?(this.calcType=q.FIXED,this.calcSize.fixed=e):this.isFixed()&&this.calcSize.fixed!==e&&(this.calcType=q.DYNAMIC,this.calcSize.fixed=0),this.calcType!==q.FIXED&&(this.calcSize.total=[...this.sizes.values()].reduce((t,e)=>t+e,0),this.calcSize.average=Math.round(this.calcSize.total/this.sizes.size))}handleHeaderSizeChange(t){this.calcSize.header=t}handleFooterSizeChange(t){this.calcSize.footer=t}}const X=(i,o,n)=>{let t=null;const r=F.computed(()=>i.isHorizontal?"offsetWidth":"offsetHeight"),e=()=>{var{event:t,dataKey:e}=i;n(t,e,o?.value?o.value[r.value]:0)};F.onMounted(()=>{"undefined"!=typeof ResizeObserver&&(t=new ResizeObserver(()=>{e()}),o?.value&&t.observe(o.value))}),F.onUpdated(()=>{e()}),F.onUnmounted(()=>{t&&(t.disconnect(),t=null)})};var W={tag:{type:String,default:"div"},event:{type:String},dataKey:{type:[String,Number]},isHorizontal:{type:Boolean}};const Y=F.defineComponent({name:"virtual-draglist-items",props:W,setup(i,{emit:t,slots:o}){const n=F.ref(null);return X(i,n,t),()=>{var{tag:t,dataKey:e}=i;return F.h(t,{ref:n,key:e,attrs:{"data-key":e}},o.default?.())}}}),V=F.defineComponent({name:"virtual-draglist-slots",props:W,setup(i,{emit:t,slots:o}){const n=F.ref(null);return X(i,n,t),()=>{var{tag:t,dataKey:e}=i;return F.h(t,{ref:n,key:e,attrs:{"data-key":e}},o.default?.())}}});return F.defineComponent({props:{dataSource:{type:Array,default:()=>[]},dataKey:{type:String,required:!0},direction:{type:String,default:"vertical"},keeps:{type:Number,default:30},size:{type:Number},delay:{type:Number,default:10},rootTag:{type:String,default:"div"},wrapTag:{type:String,default:"div"},wrapClass:{type:String,default:""},wrapStyle:{type:Object},headerTag:{type:String,default:"div"},footerTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},itemStyle:{type:Object},itemClass:{type:String,default:""},disabled:{type:Boolean,default:!1},draggable:{type:[Function,String]},dragging:{type:Function},ghostClass:{type:String,default:""},ghostStyle:{type:Object,default:()=>({})},chosenClass:{type:String,default:""},animation:{type:Number,default:150},autoScroll:{type:Boolean,default:!0},scrollStep:{type:Number,default:5},scrollThreshold:{type:Number,default:15},keepOffset:{type:Boolean,default:!1}},emits:["top","bottom","ondragstart","ondragend"],setup(h,{emit:n,slots:c}){const d=F.ref(new P),u=F.ref(new H),f=F.ref(null),g=F.ref(null),p=F.ref(null),m=F.ref([]),r=F.ref([]);let e=null;const v="vertical"!==h.direction,o=v?"scrollWidth":"scrollHeight",i=v?"scrollLeft":"scrollTop",s=v?"offsetLeft":"offsetTop",a=v?"clientWidth":"clientHeight";let y,l;function S(){return f.value?Math.ceil(f.value[i]):0}function b(t){var e;t>=m.value.length-1?function t(){p.value&&(w(p.value[s]),setTimeout(()=>{f.value&&S()+Math.ceil(f.value[a])<Math.ceil(f.value[o])&&t()},5))}():void 0!==(e=l.getOffsetByIndex(t))&&(w(e),setTimeout(()=>{S()!==l.getOffsetByIndex(t)&&b(t)},5))}function w(t){f.value&&(f.value[i]=t)}const E=()=>{r.value=m.value.map(t=>M(t))},x=()=>{y=new K({scrollEl:g.value,dataSource:m.value,getKey:M,animation:h.animation,autoScroll:h.autoScroll,scrollStep:h.scrollStep,scrollThreshold:h.scrollThreshold,disabled:h.disabled,draggable:h.draggable,ghostClass:h.ghostClass,ghostStyle:h.ghostStyle,chosenClass:h.chosenClass},(t,e)=>{u.value.from=t,n("ondragstart",m.value,t,e)},(t,e,i,o)=>{u.value.to=i,n("ondragend",t,e,i,o),o&&(y.rangeIsChanged&&l.direction&&0<d.value.start&&(-1<(o=t.indexOf(m.value[d.value.start]))&&(d.value.start=o,d.value.end=o+h.keeps-1)),m.value=[...t],E(),l.updateUniqueKeys(r.value)),D()})},D=function(i,o){let n=null;return function(){const t=this,e=arguments;n=n||setTimeout(function(){n=null,i.apply(t,e)},o)}}(()=>{u.value=new H},h.delay+17),T=t(()=>{var t,e,i;void 0===u.value.to.key?f.value&&(t=S(),e=Math.ceil(f.value[a]),!(i=Math.ceil(f.value[o]))||t<0||i+1<t+e||(l.handleScroll(t),l.isFront()?m.value.length&&t<=0&&I(this):l.isBehind()&&i<=e+t&&_(this))):D()},h.delay),I=t(()=>{n("top"),e=m.value[0]}),_=t(()=>{n("bottom")}),z=(t,e)=>{l.handleItemSizeChange(t,e)},k=(t,e)=>{l.handleHeaderSizeChange(e)},C=(t,e)=>{l.handleFooterSizeChange(e)},M=t=>{const e=h.dataKey;return(Array.isArray(e)?e:e.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce((t,e)=>(t||{})[e],t)},O=e=>m.value.findIndex(t=>M(e)==M(t));return F.watch(()=>h.dataSource,t=>{t=t,m.value=t,E(),l&&(l.updateUniqueKeys(r.value),l.updateSizes(r.value),l.updateRange()),y?y.set("dataSource",[...t]):F.nextTick(()=>x()),e&&h.keepOffset&&(b(O(e)),e=null)},{deep:!0,immediate:!0}),F.watch(()=>h.disabled,t=>{y&&y.set("disabled",t)},{immediate:!0}),F.onBeforeMount(()=>{l=new j({size:h.size,keeps:h.keeps,uniqueKeys:r.value,isHorizontal:v},t=>{void 0===u.value.to.key&&(d.value=t);var{start:e,end:i}=d.value,t=u.value.from["index"];-1<t&&!(e<=t&&t<=i)&&y&&(y.rangeIsChanged=!0)})}),F.onActivated(()=>{w(l.offset)}),F.onUnmounted(()=>{y&&y.destroy(),y=null}),()=>{const{rootTag:t,wrapTag:e,itemTag:r,headerTag:i,footerTag:o}=h;var{start:n,end:s,front:a,behind:l}=d.value,l={...h.wrapStyle,padding:v?`0px ${l}px 0px ${a}px`:a+`px 0px ${l}px`};return F.h(t,{ref:f,style:{overflow:v?"auto hidden":"hidden auto"},on:{"&scroll":T}},[c.header?F.h(V,{props:{tag:i,dataKey:"header",event:"onHeaderResized"},on:{onHeaderResized:k}},c.header()):null,F.h(e,{ref:g,attrs:{role:"group"},class:h.wrapClass,style:l},m.value.slice(n,s+1).map(t=>{var e=O(t),i=M(t),o={...h.itemStyle,...(t=>{if(!y)return{};var e=u.value.from["key"];return y.rangeIsChanged&&t==e?{display:"none"}:{}})(i)},n={isHorizontal:v,dataKey:i,tag:r,event:"onItemResized"};return c.item?F.h(Y,{key:i,props:n,class:h.itemClass,style:o,on:{onItemResized:z}},c.item({record:t,index:e,dataKey:i})):F.h(r,{key:i,attrs:{"data-key":i},class:h.itemClass,style:{...o,height:h.size+"px"}},i)})),c.footer?F.h(V,{props:{tag:o,dataKey:"footer",event:"onFooterResized"},on:{onFooterResized:C}},c.footer()):null,F.h("div",{ref:p,style:{width:v?"0px":"100%",height:v?"100%":"0px"}})])}}})});
