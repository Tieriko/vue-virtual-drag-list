!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).VirtualDragList=e(t.Vue)}(this,function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(t);function r(e,t){var i,n=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)),n}function g(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach(function(t){var e,i;e=n,t=o[i=t],i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))})}return n}function a(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var o=(function(t){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function e(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}function l(t,e,i,n){window.addEventListener?t.addEventListener(e,i,!(!n&&m)&&S):window.attachEvent&&t.attachEvent("on"+e,i)}function h(t,e,i,n){window.removeEventListener?t.removeEventListener(e,i,!(!n&&m)&&S):window.detachEvent&&t.detachEvent("on"+e,i)}function c(t){var e={top:0,left:0,height:0,width:0};e.height=t.offsetHeight,e.width=t.offsetWidth,e.top=t.offsetTop,e.left=t.offsetLeft;for(var i=t.offsetParent;null!==i;)e.top+=i.offsetTop,e.left+=i.offsetLeft,i=i.offsetParent;return e}function u(){var t=document.scrollingElement;return t||document.documentElement}function d(t){if(t.getBoundingClientRect||t===window){var e={top:0,left:0,bottom:0,right:0,height:0,width:0};return t!==window&&t.parentNode&&t!==u()?(t=t.getBoundingClientRect(),e.top=t.top,e.left=t.left,e.bottom=t.bottom,e.right=t.right,e.height=t.height,e.width=t.width):(e.top=0,e.left=0,e.bottom=window.innerHeight,e.right=window.innerWidth,e.height=window.innerHeight,e.width=window.innerWidth),e}}function f(t,e){var i={index:-1,el:null,rect:{},offset:{}},n=r(Array.from(t.children)),t=n.indexOf(e);-1<t&&Object.assign(i,{index:t,el:n[t],rect:d(n[t]),offset:c(n[t])});for(var o=0;o<n.length;o++)if(function(t,e){var i;if(t&&e)for(i=t.parentNode;i;){if(e===i)return!0;i=i.parentNode}return!1}(e,n[o])){Object.assign(i,{index:o,el:n[o],rect:d(n[o]),offset:c(n[o])});break}return i}function p(t,e,i){var n;t&&e&&(t.classList?t.classList[i?"add":"remove"](e):(n=(" "+t.className+" ").replace(_," ").replace(" "+e+" "," "),t.className=(n+(i?" "+e:"")).replace(_," ")))}function g(t,e,i){var n=t&&t.style;if(n){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];n[e=!(e in n||-1!==e.indexOf("webkit"))?"-webkit-"+e:e]=i+("string"==typeof i?"":"px")}}function y(){var n=[];return{captureAnimationState:function(){var t=r(Array.from(this.$el.children)),e=function(t,e,i){e=t.indexOf(e),i=t.indexOf(i);return e<i?{start:e,end:i}:{start:i,end:e}}(t,this.dragEl,this.dropEl),i=e.start,e=e.end;n.length=0,t.slice(i,e+1).forEach(function(t){n.push({target:t,rect:d(t)})})},animateRange:function(){var i=this;n.forEach(function(t){var e=t.target,t=t.rect;i.animate(e,t,i.animation)})},animate:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:150,n=d(e),o=t.left-n.left,r=t.top-n.top;E.forEach(function(t){return g(e,t,"none")}),x.forEach(function(t){return g(e,t,"".concat(t.split("transform")[0],"translate3d(").concat(o,"px, ").concat(r,"px, 0)"))}),e.offsetLeft,E.forEach(function(t){return g(e,t,"".concat(t.split("transition")[0],"transform ").concat(i,"ms"))}),x.forEach(function(t){return g(e,t,"".concat(t.split("transform")[0],"translate3d(0px, 0px, 0px)"))}),clearTimeout(e.animated),e.animated=setTimeout(function(){E.forEach(function(t){return g(e,t,"")}),x.forEach(function(t){return g(e,t,"")}),e.animated=null},i)}}}function v(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.$el=t,this.options=e=Object.assign({},e),this.scrollEl=function(t,e){if(!t||!t.getBoundingClientRect)return u();var i=t,n=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=g(i);if(i.clientWidth<i.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!i.getBoundingClientRect||i===document.body)return u();if(n||e)return i;n=!0}}}while(i=i.parentNode);return u()}(this.$el,!0),this.dragEl=null,this.dropEl=null,this.differ=null,this.ghost=null;var i,n,o={disabled:!(this.calcXY={x:0,y:0}),animation:150,ghostClass:"",ghostStyle:{},chosenClass:"",draggable:void 0,dragging:void 0,dragEnd:void 0,forceFallback:!1,stopPropagation:!1,supportPassive:(i=!1,document.addEventListener("checkIfSupportPassive",null,{get passive(){return i=!0}}),i),supportPointer:"PointerEvent"in window&&!b,supportTouch:"ontouchstart"in window,ownerDocument:this.$el.ownerDocument};for(n in o)n in this.options||(this.options[n]=o[n]);this.differ=new D,this.ghost=new I(this.options),Object.assign(this,y(),{_bindEventListener:function(){this._onStart=this._onStart.bind(this),this._onMove=this._onMove.bind(this),this._onDrop=this._onDrop.bind(this);var t=this.options,e=t.supportPointer,i=t.supportTouch,t=t.supportPassive;l(this.$el,e?"pointerdown":i?"touchstart":"mousedown",this._onStart,t)},_unbindEventListener:function(){var t=this.options.supportPassive;h(this.$el,"pointerdown",this._onStart,t),h(this.$el,"touchstart",this._onStart,t),h(this.$el,"mousedown",this._onStart,t),this.nativeDraggable&&(h(this.$el,"dragover",this),h(this.$el,"dragenter",this))},_onMoveEvents:function(t){var e=this.options,i=e.supportPointer,n=e.ownerDocument,e=e.supportPassive;l(n,i?"pointermove":t?"touchmove":"mousemove",this._onMove,e)},_onUpEvents:function(){var t=this.options,e=t.ownerDocument,t=t.supportPassive;l(e,"pointerup",this._onDrop,t),l(e,"pointercancel",this._onDrop,t),l(e,"touchend",this._onDrop,t),l(e,"touchcancel",this._onDrop,t),l(e,"mouseup",this._onDrop,t)},_offMoveEvents:function(){var t=this.options,e=t.ownerDocument,t=t.supportPassive;h(e,"pointermove",this._onMove,t),h(e,"touchmove",this._onMove,t),h(e,"mousemove",this._onMove,t)},_offUpEvents:function(){var t=this.options,e=t.ownerDocument,t=t.supportPassive;h(e,"pointerup",this._onDrop,t),h(e,"pointercancel",this._onDrop,t),h(e,"touchend",this._onDrop,t),h(e,"touchcancel",this._onDrop,t),h(e,"mouseup",this._onDrop,t)}}),this._bindEventListener(),this.nativeDraggable=!this.options.forceFallback&&$,this.nativeDraggable&&(l(this.$el,"dragover",this),l(this.$el,"dragenter",this)),this._handleDestroy()}var m,b,w,S,_,E,x,D,I,$;t.exports=(m=e(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),b=e(/safari/i)&&!e(/chrome/i)&&!e(/android/i),w=e(/iP(ad|od|hone)/i),t=e(/chrome/i)&&e(/android/i),S={capture:!1,passive:!1},_=/\s+/g,E=["-webkit-transition","-moz-transition","-ms-transition","-o-transition","transition"],x=["-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform"],D=function(){function t(){i(this,t),this._old_={node:null,rect:{},offset:{}},this._new_={node:null,rect:{},offset:{}}}return o(t,[{key:"get",value:function(t){return this[t]}},{key:"set",value:function(t,e){this[t]=e}},{key:"destroy",value:function(){this._old_={node:null,rect:{},offset:{}},this._new_={node:null,rect:{},offset:{}}}}]),t}(),I=function(){function e(t){i(this,e),this.options=t,this.x=0,this.y=0,this.exist=!1}return o(e,[{key:"init",value:function(t,e){var i,n;t&&(this.$el=t,i=(n=this.options).ghostClass,n=void 0===(t=n.ghostStyle)?{}:t,t=e.width,e=e.height,this.$el.class=i,this.$el.style.width=t+"px",this.$el.style.height=e+"px",this.$el.style.transform="",this.$el.style.transition="",this.$el.style.position="fixed",this.$el.style.left=0,this.$el.style.top=0,this.$el.style.zIndex=1e5,this.$el.style.opacity=.8,this.$el.style.pointerEvents="none",this.$el.style.cursor="move",this.setStyle(n))}},{key:"get",value:function(t){return this[t]}},{key:"set",value:function(t,e){this[t]=e,this[t]=e}},{key:"setStyle",value:function(t){for(var e in t)g(this.$el,e,t[e])}},{key:"rect",value:function(){return this.$el.getBoundingClientRect()}},{key:"move",value:function(){this.exist||(document.body.appendChild(this.$el),this.exist=!0),this.$el.style.transform="translate3d(".concat(this.x,"px, ").concat(this.y,"px, 0)"),"move"!==this.$el.style.cursor&&(this.$el.style.cursor="move")}},{key:"destroy",value:function(){this.$el&&this.$el.remove(),this.exist=!1}}]),e}(),$="undefined"!=typeof document&&!t&&!w&&"draggable"in document.createElement("div"),v.prototype={constructor:v,destroy:function(){this._unbindEventListener(),this._resetState()},_onStart:function(t){var e=this.options,i=e.disabled,n=e.dragging,o=e.draggable,r=e.stopPropagation;if(!(/mousedown|pointerdown/.test(t.type)&&0!==t.button||i)){e=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,i=e||t;if(this.nativeDraggable||!b||!i.target||"SELECT"!==i.target.tagName.toUpperCase()){if(i.target===this.$el)return!0;if("function"==typeof o){if(!o(i))return!0}else if("string"==typeof o){if(!function(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}(i.target,o))return!0}else if(void 0!==o)throw new Error('draggable expected "function" or "string" but received "'.concat(a(o),'"'));void 0!==t.preventDefault&&t.preventDefault(),r&&t.stopPropagation();try{document.selection?setTimeout(function(){document.selection.empty()},0):window.getSelection().removeAllRanges();var s="function"==typeof n?n(i):f(this.$el,i.target).el;if(!s)return!0;if(s.animated)return;this.dragEl=s}catch(t){throw new Error(t)}window.sortableDndOnDown=!0;r=f(this.$el,this.dragEl),t=r.index,n=r.el,s=r.rect,r=r.offset;if(!n||t<0)return!0;t=this.dragEl.cloneNode(!0);this.ghost.init(t,s),this.ghost.set("x",s.left),this.ghost.set("y",s.top),this.differ._old_.rect=s,this.differ._old_.offset=r,this.differ._old_.node=this.dragEl,this.calcXY={x:i.clientX,y:i.clientY},this._onMoveEvents(e),this._onUpEvents(e)}}},_onMove:function(t){void 0!==t.preventDefault&&t.preventDefault();var e=t.touches&&t.touches[0],i=e||t,n=i.clientX,o=i.clientY,r=e?document.elementFromPoint(n,o):i.target,s=this.options,a=s.chosenClass,l=s.stopPropagation;if(l&&t.stopPropagation(),p(this.dragEl,a,!0),this.ghost.move(),window.sortableDndOnDown&&!(n<0||o<0)){window.sortableDndOnMove=!0,this.ghost.set("x",this.ghost.x+n-this.calcXY.x),this.ghost.set("y",this.ghost.y+o-this.calcXY.y),this.calcXY={x:n,y:o},this.ghost.move();var h=d(this.$el);if(n<h.left||n>h.right||o<h.top||o>h.bottom)this.ghost.setStyle({cursor:"not-allowed"});else{var u=f(this.$el,r),e=u.index,i=u.el,s=u.rect,l=u.offset,t=s.left,a=s.right,r=s.top,u=s.bottom;if(!(!i||e<0||r<0)){s=this.scrollEl,e=s.scrollTop,s=s.scrollLeft,s=h.left+s,e=h.top+e;if(this.scrollEl!==this.$el&&(h.left<0||h.top<0)){if(h.top<0&&r<e||h.left<0&&t<s)return}else if(r<h.top||t<h.left)return;t<n&&n<a&&r<o&&o<u&&(this.dropEl=i,this.dropEl!==this.dragEl&&(this.dropEl.animated||(this.captureAnimationState(),(i=c(this.dragEl)).top<l.top||i.left<l.left?this.$el.insertBefore(this.dragEl,this.dropEl.nextElementSibling):this.$el.insertBefore(this.dragEl,this.dropEl),this.animateRange(),this.differ._new_.node=this.dropEl,this.differ._new_.rect=d(this.dropEl))))}}}},_onDrop:function(t){this._offMoveEvents(),this._offUpEvents();var e=this.options,i=e.dragEnd,n=e.chosenClass;if(e.stopPropagation&&t.stopPropagation(),p(this.dragEl,n,!1),window.sortableDndOnDown&&window.sortableDndOnMove){this.differ._new_.offset=c(this.dragEl);e=this.differ,t=e._old_,n=e._new_,e=t.offset.top!==n.offset.top||t.offset.left!==n.offset.left;if(e||(this.differ._new_.node=this.differ._old_.node),"function"!=typeof i)throw new Error('Sortable-dnd Error: dragEnd expected "function" but received "'.concat(a(i),'"'));i(t,n,e)}this.differ.destroy(),this.ghost.destroy(),this._removeWindowState()},_handleDestroy:function(){var t=this,e=null,i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(i){var n=this.options.ownerDocument;if(!n)return;(e=new i(function(){n.body.contains(t.$el)||(e.disconnect(),e=null,t._unbindEventListener(),t._resetState())})).observe(this.$el.parentNode,{childList:!0,attributes:!1,subtree:!1})}window.onbeforeunload=function(){e&&e.disconnect(),e=null,t._unbindEventListener(),t._resetState()}},_resetState:function(){this.dragEl=null,this.dropEl=null,this.ghost.destroy(),this.differ.destroy(),this.calcXY={x:0,y:0},this._removeWindowState()},_removeWindowState:function(){window.sortableDndOnDown=null,window.sortableDndOnMove=null,delete window.sortableDndOnDown,delete window.sortableDndOnMove}},v)}(l={exports:{}}),l.exports),s={inject:["virtual"],data:function(){return{observer:null}},mounted:function(){var t=this;"undefined"!=typeof ResizeObserver&&(this.observer=new ResizeObserver(function(){t.onSizeChange()}),this.$el&&this.observer.observe(this.$el))},updated:function(){this.onSizeChange()},beforeDestroy:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},methods:{onSizeChange:function(){this.virtual[this.event](this.uniqueKey,this.getCurrentSize())},getCurrentSize:function(){return this.$el?this.$el.offsetHeight:0}}},t={dataSource:{type:Array,default:function(){return[]}},dataKey:{type:String,required:!0},height:{type:String,default:"100%"},keeps:{type:Number,default:30},size:{type:Number},delay:{type:Number,default:10},headerTag:{type:String,default:"div"},footerTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},itemStyle:{type:Object,default:function(){return{}}},itemClass:{type:String,default:""},disabled:{type:Boolean,default:!1},draggable:{type:[Function,String]},dragging:{type:Function},ghostClass:{type:String,default:""},ghostStyle:{type:Object,default:function(){return{backgroundImage:"linear-gradient(to bottom, rgba(255, 255, 255, 0.1) 0%, rgba(0, 0, 0, 0.1) 40%, rgba(0, 0, 0, 0.1) 98%, #FFFFFF 100%)"}}},chosenClass:{type:String,default:""},animation:{type:Number,default:150}},l={tag:{type:String,default:"div"},event:{type:String},dragStyle:{type:Object,default:function(){return{}}},uniqueKey:{type:[String,Number]}},y=i.default.component("virtual-draglist-items",{mixins:[s],props:l,render:function(t){var e=this.tag,i=this.uniqueKey;return t(e,{key:i,attrs:{"data-key":i}},this.$slots.default)}}),v=i.default.component("virtual-draglist-slots",{mixins:[s],props:l,render:function(t){var e=this.tag,i=this.uniqueKey;return t(e,{key:i,attrs:{role:i}},this.$slots.default)}}),m=function(r){function t(){for(var t,e=this,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return h&&clearTimeout(h),l?(t=!h,h=setTimeout(function(){h=null},a),t&&(s=r.apply(this,n))):h=setTimeout(function(){r.apply(e,n)},a),s}var s,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:50,l=2<arguments.length&&void 0!==arguments[2]&&arguments[2],h=null;return t.cancel=function(){clearTimeout(h),h=null},t};return i.default.component("virtual-drag-list",{props:t,data:function(){return{list:[],sizeStack:new Map,start:0,end:0,offset:0,direction:"",uniqueKeys:[],lastCalcIndex:0,calcType:"INIT",calcSize:{average:0,total:0,fixed:0,header:0,footer:0},padding:{front:0,behind:0},dragState:{oldNode:null,oldItem:null,oldIndex:null,newNode:null,newItem:null,newIndex:null},drag:null}},provide:function(){return{virtual:this}},computed:{uniqueKeyLen:function(){return this.uniqueKeys.length-1},isFixedType:function(){return"FIXED"===this.calcType}},watch:{dataSource:{handler:function(t){this._initVirtual(t)},deep:!0,immediate:!0},disabled:{handler:function(t){var e=this;t?this._destroyDraggable():this.$nextTick(function(){return e._initDraggable()})},immediate:!0}},mounted:function(){this.end=this.start+this.keeps},beforeDestroy:function(){this._destroyDraggable()},methods:{reset:function(){this.scrollToTop(),this._initVirtual(this.dataSource)},getSize:function(t){return this.sizeStack.get(t)},getOffset:function(){return this.offset},scrollToBottom:function(){var t=this,e=this.$refs,i=e.bottomItem,e=e.virtualDragList;i&&(i=i.offsetTop,this.scrollToOffset(i));var n=this.$el.clientHeight,o=e.scrollTop,r=e.scrollHeight;setTimeout(function(){o+n<r&&t.scrollToBottom()},10)},scrollToTop:function(){this.$refs.virtualDragList.scrollTop=0},scrollToOffset:function(t){this.$refs.virtualDragList.scrollTop=t},scrollToIndex:function(t){t>=this.list.length-1?this.scrollToBottom():(t=this._getOffsetByIndex(t),this.scrollToOffset(t))},_setList:function(t){this.list=t},_handleDragEnd:function(t,e,i,n){this.$emit("ondragend",t,e,i,n)},_initVirtual:function(t){var e=this;this.list=a(t),this.uniqueKeys=this.list.map(function(t){return e._uniqueId(t)}),this._handleSourceDataChange(),this._updateSizeStack()},_handleScroll:function(t){var e=this.$refs.virtualDragList,i=Math.ceil(this.$el.clientHeight),n=Math.ceil(e.scrollTop),o=Math.ceil(e.scrollHeight);n<0||o+1<n+i||!o||(this.direction=n<this.offset?"FRONT":"BEHIND",this.offset=n,e=this._getScrollOvers(),"FRONT"===this.direction?(this._handleFront(e),this.list.length&&n<=0&&this.$emit("top")):"BEHIND"===this.direction&&(this._handleBehind(e),o<=i+n&&this.$emit("bottom")))},_handleFront:function(t){t>this.start||(t=Math.max(t-Math.round(this.keeps/3),0),this._checkRange(t,this._getEndByStart(t)))},_handleBehind:function(t){t<this.start+Math.round(this.keeps/3)||this._checkRange(t,this._getEndByStart(t))},_onItemResized:function(t,e){this.sizeStack.set(t,e),"INIT"===this.calcType?(this.calcSize.fixed=e,this.calcType="FIXED"):"FIXED"===this.calcType&&this.calcSize.fixed!==e&&(this.calcType="DYNAMIC",delete this.calcSize.fixed),"FIXED"!==this.calcType&&"undefined"!==this.calcSize.total&&(this.sizeStack.size<Math.min(this.keeps,this.uniqueKeys.length)?(this.calcSize.total=a(this.sizeStack.values()).reduce(function(t,e){return t+e},0),this.calcSize.average=Math.round(this.calcSize.total/this.sizeStack.size)):delete this.calcSize.total)},_onHeaderResized:function(t,e){this.calcSize.header=e},_onFooterResized:function(t,e){this.calcSize.footer=e},_handleSourceDataChange:function(){var t=Math.max(this.start,0);this.updateRange(this.start,this._getEndByStart(t))},_updateSizeStack:function(){var i=this;this.sizeStack.forEach(function(t,e){i.uniqueKeys.includes(e)||i.sizeStack.delete(e)})},_checkRange:function(t,e){var i=this.keeps;this.uniqueKeys.length<=i?(t=0,e=this.uniqueKeyLen):e-t<i-1&&(t=e-i+1),this.start!==t&&this.updateRange(t,e)},updateRange:function(t,e){this.start=t,this.end=e,this.padding={front:this._getFront(),behind:this._getBehind()}},_getScrollOvers:function(){var t=this.offset-this.calcSize.header;if(t<=0)return 0;if(this.isFixedType)return Math.floor(t/this.calcSize.fixed);for(var e,i,n=0,o=this.uniqueKeys.length;n<=o;){if(e=n+Math.floor((o-n)/2),(i=this._getOffsetByIndex(e))===t)return e;i<t?n=e+1:t<i&&(o=e-1)}return 0<n?--n:0},_getFront:function(){return this.isFixedType?this.calcSize.fixed*this.start:this._getOffsetByIndex(this.start)},_getBehind:function(){var t=this.uniqueKeyLen;return this.isFixedType?(t-this.end)*this.calcSize.fixed:this.lastCalcIndex===t?this._getOffsetByIndex(t)-this._getOffsetByIndex(this.end):(t-this.end)*this._getItemSize()},_getOffsetByIndex:function(t){if(!t)return 0;for(var e,i=0,n=0;n<t;n++)i+="number"==typeof(e=this.sizeStack.get(this.uniqueKeys[n]))?e:this._getItemSize();return this.lastCalcIndex=Math.max(this.lastCalcIndex,t-1),this.lastCalcIndex=Math.min(this.lastCalcIndex,this.uniqueKeyLen),i},_getItemIndex:function(e){var i=this;return this.list.findIndex(function(t){return i._uniqueId(e)==i._uniqueId(t)})},_getItemSize:function(){return this.isFixedType?this.calcSize.fixed:this.calcSize.average||this.size},_getEndByStart:function(t){return Math.min(t+this.keeps,this.uniqueKeyLen)},_uniqueId:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=this.dataKey;return(Array.isArray(i)?i:i.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce(function(t,e){return(t||{})[e]},t)||e},_initDraggable:function(){var s=this;this._destroyDraggable(),this.drag=new o(this.$refs.content,{disabled:this.disabled,ghostStyle:this.dragStyle,draggable:this.draggable,dragging:this.dragging,chosenClass:this.chosenClass,animation:this.animation,dragEnd:function(t,e,i){var n=t.node.getAttribute("data-key"),o=e.node.getAttribute("data-key");s.dragState.oldNode=t.node,s.dragState.newNode=e.node,s.list.forEach(function(t,e){s._uniqueId(t)===n&&(s.dragState.oldItem=t,s.dragState.oldIndex=e),s._uniqueId(t)===o&&(s.dragState.newItem=t,s.dragState.newIndex=e)});var r=a(s.list);i&&(r.splice(s.dragState.oldIndex,1),r.splice(s.dragState.newIndex,0,s.dragState.oldItem),s._setList(r)),s._handleDragEnd(r,g(g({},t),{},{item:s.dragState.oldItem,index:s.dragState.oldIndex}),g(g({},e),{},{item:s.dragState.newItem,index:s.dragState.newIndex}),i)}})},_destroyDraggable:function(){this.drag&&this.drag.destroy(),this.drag=null}},render:function(n){var o=this,t=this.$slots,e=t.header,i=t.footer,r=this.height,s=this.padding,a=this.headerTag,l=this.footerTag,h=this.itemTag,u=this.itemStyle,c=this.itemClass,d=this.dragStyle,f=this.list,p=this.start,t=this.end;return n("div",{ref:"virtualDragList",on:{"&scroll":m(this._handleScroll,this.delay)},style:{height:r,overflow:"hidden auto",position:"relative"}},[e?n(v,{props:{tag:a,uniqueKey:"header",event:"_onHeaderResized"}},e):null,n("div",{ref:"content",attrs:{role:"content"},style:{padding:"".concat(s.front,"px 0px ").concat(s.behind,"px")}},f.slice(p,t+1).map(function(t){var e=o._getItemIndex(t),i=o._uniqueId(t);return o.$scopedSlots.item?n(y,{key:i,props:{uniqueKey:i,dragStyle:d,tag:h,event:"_onItemResized"},style:u,class:c},o.$scopedSlots.item({record:t,index:e,dataKey:i})):n(h,{key:i,attrs:{"data-key":i},style:g({height:"".concat(o.size,"px")},u),class:c},i)})),i?n(v,{props:{tag:l,uniqueKey:"footer",event:"_onFooterResized"}},i):null,n("div",{ref:"bottomItem"})])}})});
