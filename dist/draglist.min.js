!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).VirtualDragList=e(t.Vue)}(this,function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(t);function r(e,t){var i,n=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)),n}function v(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach(function(t){var e,i;e=n,t=o[i=t],i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))})}return n}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function h(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function m(r,t,e){function i(){for(var t,e=this,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return h&&clearTimeout(h),l?(t=!h,h=setTimeout(function(){h=null},a),t&&(s=r.apply(this,n))):h=setTimeout(function(){r.apply(e,n)},a),s}var s,a=1<arguments.length&&void 0!==t?t:50,l=2<arguments.length&&void 0!==e&&e,h=null;return i.cancel=function(){clearTimeout(h),h=null},i}var l="INIT",c="FIXED",u="DYNAMIC",f="FRONT",d="BEHIND",p=s(function t(){n(this,t),this.average=void 0,this.total=void 0,this.fixed=void 0,this.header=void 0,this.footer=void 0}),g=s(function t(){n(this,t),this.start=0,this.end=0,this.front=0,this.behind=0});function y(t,e){this.options=t,this.callback=e,this.sizes=new Map,this.isHorizontal=t.isHorizontal,this.calcIndex=0,this.calcType=l,this.calcSize=new p,this.direction="",this.offset=0,this.range=new g,t&&this.checkIfUpdate(0,t.keeps-1)}y.prototype={construcrot:y,updateUniqueKeys:function(t){this.options.uniqueKeys=t},updateSizes:function(i){var n=this;this.sizes.forEach(function(t,e){i.includes(e)||n.sizes.delete(e)})},updateRange:function(){var t=Math.max(this.range.start,0);this.handleUpdate(t,this.getEndByStart(t))},handleScroll:function(t){this.direction=t<this.offset?f:d,this.offset=t;t=this.getScrollItems(t);this.isFront()?this.handleScrollFront(t):this.isBehind()&&this.handleScrollBehind(t)},isFront:function(){return this.direction===f},isBehind:function(){return this.direction===d},getScrollItems:function(t){var e=this.calcSize,i=e.fixed,e=e.header;if(e&&(t-=e),t<=0)return 0;if(this.calcType===c)return Math.floor(t/i);for(var n,o,r=0,s=this.options.uniqueKeys.length;r<=s;){if(n=r+Math.floor((s-r)/2),(o=this.getOffsetByIndex(n))===t)return n;o<t?r=n+1:t<o&&(s=n-1)}return 0<r?--r:0},handleScrollFront:function(t){t>this.range.start||(t=Math.max(t-Math.round(this.options.keeps/3),0),this.checkIfUpdate(t,this.getEndByStart(t)))},handleScrollBehind:function(t){t<this.range.start+Math.round(this.options.keeps/3)||this.checkIfUpdate(t,this.getEndByStart(t))},checkIfUpdate:function(t,e){var i=this.options,n=i.uniqueKeys,i=i.keeps;n.length<=i?(t=0,e=n.length-1):e-t<i-1&&(t=e-i+1),this.range.start!==t&&this.handleUpdate(t,e)},handleUpdate:function(t,e){this.range.start=t,this.range.end=e,this.range.front=this.getFrontOffset(),this.range.behind=this.getBehindOffset(),this.callback(v({},this.range))},getFrontOffset:function(){return this.calcType===c?this.calcSize.fixed*this.range.start:this.getOffsetByIndex(this.range.start)},getBehindOffset:function(){var t=this.getLastIndex();return this.calcType===c?(t-this.range.end)*this.calcSize.fixed:this.calcIndex===t?this.getOffsetByIndex(t)-this.getOffsetByIndex(this.range.end):(t-this.range.end)*this.getItemSize()},getOffsetByIndex:function(t){if(!t)return 0;for(var e=0,i=0;i<t;i++){var n=this.sizes.get(this.options.uniqueKeys[i]);e+="number"==typeof n?n:this.getItemSize()}return this.calcIndex=Math.max(this.calcIndex,t-1),this.calcIndex=Math.min(this.calcIndex,this.getLastIndex()),e},getEndByStart:function(t){return Math.min(t+this.options.keeps-1,this.getLastIndex())},getLastIndex:function(){return this.options.uniqueKeys.length-1},getItemSize:function(){return this.calcType===c?this.calcSize.fixed:this.calcSize.average||this.options.size},handleItemSizeChange:function(t,e){this.sizes.set(t,e),this.calcType===l?(this.calcType=c,this.calcSize.fixed=e):this.calcType===c&&this.calcSize.fixed!==e&&(this.calcType=u,this.calcSize.fixed=void 0),this.calcType!==c&&(this.calcSize.total=h(this.sizes.values()).reduce(function(t,e){return t+e},0),this.calcSize.average=Math.round(this.calcSize.total/this.sizes.size))},handleHeaderSizeChange:function(t){this.calcSize.header=t},handleFooterSizeChange:function(t){this.calcSize.footer=t}};var b=(function(t){function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function e(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}function a(e,i){i?"none"===i?O.forEach(function(t){return f(e,t,"none")}):O.forEach(function(t){return f(e,t,"".concat(t.split("transition")[0],"transform ").concat(i))}):O.forEach(function(t){return f(e,t,"")})}function l(e,i){i?T.forEach(function(t){return f(e,t,"".concat(t.split("transform")[0]).concat(i))}):T.forEach(function(t){return f(e,t,"")})}function h(t,e,i,n){window.addEventListener?t.addEventListener(e,i,!(!n&&S)&&z):window.attachEvent&&t.attachEvent("on"+e,i)}function c(t,e,i,n){window.removeEventListener?t.removeEventListener(e,i,!(!n&&S)&&z):window.detachEvent&&t.detachEvent("on"+e,i)}function g(t){var e={top:0,left:0,height:0,width:0};e.height=t.offsetHeight,e.width=t.offsetWidth,e.top=t.offsetTop,e.left=t.offsetLeft;for(var i=t.offsetParent;null!==i;)e.top+=i.offsetTop,e.left+=i.offsetLeft,i=i.offsetParent;return e}function u(){var t=document.scrollingElement;return!t||t.contains(document.body)?document:t}function y(t){if(t.getBoundingClientRect||t===window){var e={top:0,left:0,bottom:0,right:0,height:0,width:0};return t!==window&&t.parentNode&&t!==u()?(t=t.getBoundingClientRect(),e.top=t.top,e.left=t.left,e.bottom=t.bottom,e.right=t.right,e.height=t.height,e.width=t.width):(e.top=0,e.left=0,e.bottom=window.innerHeight,e.right=window.innerWidth,e.height=window.innerHeight,e.width=window.innerWidth),e}}function v(t,e,i){var n=r(Array.from(t.children)),t=n.indexOf(e);if(-1<t)return i?n[t]:{index:t,el:n[t],rect:y(n[t]),offset:g(n[t])};for(var o=0;o<n.length;o++)if(function(t,e){var i;if(t&&e)for(i=t.parentNode;i;){if(e===i)return!0;i=i.parentNode}return!1}(e,n[o]))return i?n[o]:{index:o,el:n[o],rect:y(n[o]),offset:g(n[o])};return i?null:{index:-1,el:null,rect:{},offset:{}}}function m(t,e,i){var n;t&&e&&(t.classList?t.classList[i?"add":"remove"](e):(n=(" "+t.className+" ").replace(_," ").replace(" "+e+" "," "),t.className=(n+(i?" "+e:"")).replace(_," ")))}function f(t,e,i){var n=t&&t.style;if(n){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];n[e=!(e in n||-1!==e.indexOf("webkit"))?"-webkit-"+e:e]=i+("string"==typeof i?"":"px")}}function d(){var o=[];return{captureAnimationState:function(){var t,e=r(Array.from(this.$el.children)),i=(t=e,n=this.dragEl,i=this.dropEl,n=t.indexOf(n),i=t.indexOf(i),n<i?{start:n,end:i}:{start:i,end:n}),n=i.start,i=i.end;o.length=0,e.slice(n,i+1).forEach(function(t){o.push({target:t,rect:y(t)})})},animateRange:function(){var i=this;o.forEach(function(t){var e=t.target,t=t.rect;i.animate(e,t,i.animation)})},animate:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:150,n=y(t),o=e.left-n.left,n=e.top-n.top;a(t,"none"),l(t,"translate3d(".concat(o,"px, ").concat(n,"px, 0)")),t.offsetLeft,a(t,"".concat(i,"ms")),l(t,"translate3d(0px, 0px, 0px)"),clearTimeout(t.animated),t.animated=setTimeout(function(){a(t,""),l(t,""),t.animated=null},i)}}}function b(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.$el=t,this.options=e=Object.assign({},e),this.scrollEl=function(t,e){if(!t||!t.getBoundingClientRect)return u();var i=t,n=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=f(i);if(i.clientWidth<i.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!i.getBoundingClientRect||i===document.body)return u();if(n||e)return i;n=!0}}}while(i=i.parentNode);return u()}(this.$el,!0),this.dragEl=null,this.dropEl=null,this.differ=null,this.ghost=null;var i,n,o={delay:0,delayOnTouchOnly:!(this.calcXY={x:0,y:0}),disabled:!1,animation:150,ghostAnimation:0,ghostClass:"",ghostStyle:{},chosenClass:"",draggable:void 0,dragging:void 0,onDrag:void 0,onMove:void 0,onDrop:void 0,onChange:void 0,forceFallback:!1,stopPropagation:!1,supportPassive:(i=!1,document.addEventListener("checkIfSupportPassive",null,{get passive(){return i=!0}}),i),supportPointer:"PointerEvent"in window&&!x,supportTouch:"ontouchstart"in window,ownerDocument:this.$el.ownerDocument};for(n in o)n in this.options||(this.options[n]=o[n]);this.nativeDraggable=!this.options.forceFallback&&I,this.differ=new D,this.ghost=new $(this.options),Object.assign(this,d(),{_bindEventListener:function(){this._onStart=this._onStart.bind(this),this._onMove=this._onMove.bind(this),this._onDrop=this._onDrop.bind(this);var t=this.options,e=t.supportPointer,i=t.supportTouch,t=t.supportPassive;h(this.$el,e?"pointerdown":i?"touchstart":"mousedown",this._onStart,t),this.nativeDraggable&&(h(this.$el,"dragover",this),h(this.$el,"dragenter",this))},_unbindEventListener:function(){var t=this.options.supportPassive;c(this.$el,"pointerdown",this._onStart,t),c(this.$el,"touchstart",this._onStart,t),c(this.$el,"mousedown",this._onStart,t),this.nativeDraggable&&(c(this.$el,"dragover",this),c(this.$el,"dragenter",this))},_onMoveEvents:function(t){var e=this.options,i=e.supportPointer,n=e.ownerDocument,e=e.supportPassive;h(n,i?"pointermove":t?"touchmove":"mousemove",this._onMove,e)},_onUpEvents:function(){var t=this.options,e=t.ownerDocument,t=t.supportPassive;h(e,"pointerup",this._onDrop,t),h(e,"pointercancel",this._onDrop,t),h(e,"touchend",this._onDrop,t),h(e,"touchcancel",this._onDrop,t),h(e,"mouseup",this._onDrop,t)},_offMoveEvents:function(){var t=this.options,e=t.ownerDocument,t=t.supportPassive;c(e,"pointermove",this._onMove,t),c(e,"touchmove",this._onMove,t),c(e,"mousemove",this._onMove,t)},_offUpEvents:function(){var t=this.options,e=t.ownerDocument,t=t.supportPassive;c(e,"pointerup",this._onDrop,t),c(e,"pointercancel",this._onDrop,t),c(e,"touchend",this._onDrop,t),c(e,"touchcancel",this._onDrop,t),c(e,"mouseup",this._onDrop,t)}}),this._bindEventListener(),this._handleDestroy()}var S,w,x,E,z,_,O,T,D,$,I;t.exports=(S=e(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),w=e(/Edge/i),x=e(/safari/i)&&!e(/chrome/i)&&!e(/android/i),E=e(/iP(ad|od|hone)/i),t=e(/chrome/i)&&e(/android/i),z={capture:!1,passive:!1},_=/\s+/g,O=["-webkit-transition","-moz-transition","-ms-transition","-o-transition","transition"],T=["-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform"],D=function(){function t(){i(this,t),this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}return o(t,[{key:"get",value:function(t){return this[t]}},{key:"set",value:function(t,e){this[t]=e}},{key:"destroy",value:function(){this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}}]),t}(),$=function(){function e(t){i(this,e),this.options=t,this.x=0,this.y=0,this.exist=!1}return o(e,[{key:"init",value:function(t,e){var i,n;t&&(this.$el=t,i=(n=this.options).ghostClass,n=void 0===(t=n.ghostStyle)?{}:t,t=e.width,e=e.height,this.$el.class=i,this.$el.style.width=t+"px",this.$el.style.height=e+"px",this.$el.style.position="fixed",this.$el.style.left=0,this.$el.style.top=0,this.$el.style.zIndex=1e5,this.$el.style.opacity=.8,this.$el.style.pointerEvents="none",this.$el.style.cursor="move",a(this.$el,"none"),l(this.$el,"translate3d(0px, 0px, 0px)"),this.setStyle(n))}},{key:"get",value:function(t){return this[t]}},{key:"set",value:function(t,e){this[t]=e,this[t]=e}},{key:"setStyle",value:function(t){for(var e in t)f(this.$el,e,t[e])}},{key:"rect",value:function(){return y(this.$el)}},{key:"move",value:function(t){var e=this.options.ghostAnimation;a(this.$el,t?"".concat(e,"ms"):"none"),this.exist||(document.body.appendChild(this.$el),this.exist=!0),l(this.$el,"translate3d(".concat(this.x,"px, ").concat(this.y,"px, 0)")),"move"!==this.$el.style.cursor&&(this.$el.style.cursor="move")}},{key:"destroy",value:function(t){var e=this;t&&(this.x=t.left,this.y=t.top,this.move(!0));t=this.options.ghostAnimation;t?setTimeout(function(){return e.clear()},t):this.clear()}},{key:"clear",value:function(){this.$el&&this.$el.remove(),this.$el=null,this.x=0,this.y=0,this.exist=!1}}]),e}(),I="undefined"!=typeof document&&!t&&!E&&"draggable"in document.createElement("div"),b.prototype={constructor:b,destroy:function(){this._unbindEventListener(),this._resetState()},_onStart:function(t){var e=this.options,i=e.delay,n=e.disabled,o=e.stopPropagation,r=e.delayOnTouchOnly;if(!(/mousedown|pointerdown/.test(t.type)&&0!==t.button||n)){e=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,n=e||t;if(this.nativeDraggable||!x||!n.target||"SELECT"!==n.target.tagName.toUpperCase()){if(n.target===this.$el)return!0;o&&t.stopPropagation(),!i||r&&!e||this.nativeDraggable&&(w||S)?this._onDrag(n,e):this.dragStartTimer=setTimeout(this._onDrag(n,e),i)}}},_onDrag:function(t,e){var i=this.options,n=i.draggable,i=i.dragging;if("function"==typeof n){if(!n(t))return!0}else if("string"==typeof n){if(!function(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}(t.target,n))return!0}else if(void 0!==n)throw new Error('draggable expected "function" or "string" but received "'.concat(p(n),'"'));try{document.selection?setTimeout(function(){document.selection.empty()},0):window.getSelection().removeAllRanges()}catch(t){throw new Error(t)}if(i){if("function"!=typeof i)throw new Error('dragging expected "function" or "string" but received "'.concat(p(i),'"'));this.dragEl=i(t)}else this.dragEl=v(this.$el,t.target,!0);if(!this.dragEl||this.dragEl.animated)return!0;n=v(this.$el,this.dragEl),i=n.rect,n=n.offset;window.sortableDndOnDownState=!0,this.ghost.set("x",i.left),this.ghost.set("y",i.top),this.differ.from={node:this.dragEl,rect:i,offset:n},this.calcXY={x:t.clientX,y:t.clientY},this._onMoveEvents(e),this._onUpEvents(e)},_onMove:function(t){void 0!==t.preventDefault&&t.preventDefault();var e=this.options,i=e.chosenClass,n=e.stopPropagation,o=e.onMove,r=e.onDrag;n&&t.stopPropagation();var s=t.touches&&t.touches[0],a=s||t,l=a.clientX,h=a.clientY,c=s?document.elementFromPoint(l,h):a.target;if(!this.ghost.$el&&(this.ghost.init(this.dragEl.cloneNode(!0),this.differ.from.rect),void 0!==r)){if("function"!=typeof r)throw new Error('onDrag expected "function" but received "'.concat(p(r),'"'));r(this.dragEl,a,t)}if(void 0!==o){if("function"!=typeof o)throw new Error('onMove expected "function" but received "'.concat(p(o),'"'));o(this.differ.from,this.ghost.$el,a,t)}if(m(this.dragEl,i,!0),this.ghost.move(),window.sortableDndOnDownState&&!(l<0||h<0)){window.sortableDndOnMoveState=!0,this.ghost.set("x",this.ghost.x+l-this.calcXY.x),this.ghost.set("y",this.ghost.y+h-this.calcXY.y),this.calcXY={x:l,y:h},this.ghost.move();var u=y(this.$el);if(l<u.left||l>u.right||h<u.top||h>u.bottom)this.ghost.setStyle({cursor:"not-allowed"});else{var f=v(this.$el,c),d=f.index,e=f.el,n=f.rect,s=f.offset,r=n.left,o=n.right,i=n.top,c=n.bottom;if(!(!e||d<0||i<0)){f=this.scrollEl,d=f.scrollTop,f=f.scrollLeft,f=u.left+f,d=u.top+d;if(this.scrollEl!==this.$el&&(u.left<0||u.top<0)){if(u.top<0&&i<d||u.left<0&&r<f)return}else if(i<u.top||r<u.left)return;if(this.dropEl=e,r<l&&l<o&&i<h&&h<c&&e!==this.dragEl&&(this.differ.to={node:this.dropEl,rect:n,offset:s},!e.animated)){this.captureAnimationState();c=this.options.onChange,n=g(this.dragEl);if(void 0!==c){if("function"!=typeof c)throw new Error('onChange expected "function" but received "'.concat(p(c),'"'));c(this.differ.from,this.differ.to,a,t)}n.top<s.top||n.left<s.left?this.$el.insertBefore(this.dragEl,e.nextElementSibling):this.$el.insertBefore(this.dragEl,e),this.animateRange()}}}}},_onDrop:function(t){this._offMoveEvents(),this._offUpEvents(),clearTimeout(this.dragStartTimer);var e=this.options,i=e.onDrop,n=e.chosenClass;if(e.stopPropagation&&t.stopPropagation(),m(this.dragEl,n,!1),window.sortableDndOnDownState&&window.sortableDndOnMoveState){this.differ.to.offset=g(this.dragEl),this.differ.to.rect=y(this.dragEl);e=this.differ,n=e.from,e=e.to,e=n.offset.top!==e.offset.top||n.offset.left!==e.offset.left;if(void 0!==i){if("function"!=typeof i)throw new Error('onDrop expected "function" but received "'.concat(p(i),'"'));i(e,t)}this.ghost.destroy(y(this.dragEl))}this.differ.destroy(),this._removeWindowState()},_resetState:function(){this.dragEl=null,this.dropEl=null,this.ghost.destroy(),this.differ.destroy(),this.calcXY={x:0,y:0},this._removeWindowState()},_removeWindowState:function(){window.sortableDndOnDownState=null,window.sortableDndOnMoveState=null,window.sortableDndAnimationEnd=null,delete window.sortableDndOnDownState,delete window.sortableDndOnMoveState,delete window.sortableDndAnimationEnd},_handleDestroy:function(){var t=this,e=null,i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(i){var n=this.options.ownerDocument;if(!n)return;(e=new i(function(){n.body.contains(t.$el)||(e.disconnect(),e=null,t._unbindEventListener(),t._resetState())})).observe(this.$el.parentNode,{childList:!0,attributes:!1,subtree:!1})}window.onbeforeunload=function(){e&&e.disconnect(),e=null,t._unbindEventListener(),t._resetState()}}},b)}(x={exports:{}}),x.exports),S={data:function(){return{dragState:{from:{key:null,item:null,index:null},to:{key:null,item:null,index:null}}}},methods:{_initSortable:function(){var r=this,s=[],a=-1,n=null,l=!1;this._destroySortable(),this.drag=new b(this.$refs.wrapper,{disabled:this.disabled,ghostStyle:this.dragStyle,draggable:this.draggable,dragging:this.dragging,chosenClass:this.chosenClass,animation:this.animation,onDrag:function(t){n=t,s=h(r.list);var e=t.getAttribute("data-key");a=r.list.findIndex(function(t){return r._getUniqueKey(t)===e}),r.dragState.from.index=a,r.dragState.from.key=e},onChange:function(t,e){l||(l=!0,r.list.splice(a,1));var n=r.dragState.from.key,o=e.node.getAttribute("data-key");r.dragState.to.key=o,s.forEach(function(t,e){var i=r._getUniqueKey(t);i===n&&Object.assign(r.dragState.from,{item:t,index:e}),i===o&&Object.assign(r.dragState.to,{item:t,index:e})});var i=r.dragState,e=i.from,i=i.to;s.splice(e.index,1),s.splice(i.index,0,e.item)},onDrop:function(t){r.dragState.to.index=s.findIndex(function(t){return r._getUniqueKey(t)===r.dragState.from.key});var e=r.dragState,i=e.from,e=e.to;l&&n&&n.remove(),r.handleDragEnd(s,i,e,t),r.list=s,r.uniqueKeys=r.list.map(function(t){return r._getUniqueKey(t)}),n=null,l=!1}})},_destroySortable:function(){this.drag&&this.drag.destroy(),this.drag=null}}},w={dataSource:{type:Array,default:function(){return[]}},dataKey:{type:String,required:!0},direction:{type:String,default:"vertical"},height:{type:String,default:"100%"},keeps:{type:Number,default:30},size:{type:Number},delay:{type:Number,default:0},rootStyle:{type:Object},rootClass:{type:String,default:""},wrapClass:{type:String,default:""},wrapStyle:{type:Object},headerTag:{type:String,default:"div"},footerTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},itemStyle:{type:Object},itemClass:{type:String,default:""},disabled:{type:Boolean,default:!1},draggable:{type:[Function,String]},dragging:{type:Function},ghostClass:{type:String,default:""},ghostStyle:{type:Object,default:function(){return{backgroundImage:"linear-gradient(to bottom, rgba(255, 255, 255, 0.1) 0%, rgba(0, 0, 0, 0.1) 40%, rgba(0, 0, 0, 0.1) 98%, #FFFFFF 100%)"}}},chosenClass:{type:String,default:""},animation:{type:Number,default:150}},t={tag:{type:String,default:"div"},event:{type:String},uniqueKey:{type:[String,Number]},isHorizontal:{type:Boolean}},x={inject:["virtual"],data:function(){return{observer:null}},mounted:function(){var t=this;"undefined"!=typeof ResizeObserver&&(this.observer=new ResizeObserver(function(){t.onSizeChange()}),this.$el&&this.observer.observe(this.$el))},updated:function(){this.onSizeChange()},beforeDestroy:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},methods:{onSizeChange:function(){this.virtual[this.event](this.uniqueKey,this.getCurrentSize())},getCurrentSize:function(){var t=this.isHorizontal?"offsetWidth":"offsetHeight";return this.$el?this.$el[t]:0}}},E=i.default.component("virtual-draglist-items",{mixins:[x],props:t,render:function(t){var e=this.tag,i=this.uniqueKey;return t(e,{key:i,attrs:{"data-key":i}},this.$slots.default)}}),z=i.default.component("virtual-draglist-slots",{mixins:[x],props:t,render:function(t){var e=this.tag,i=this.uniqueKey;return t(e,{key:i,attrs:{role:i}},this.$slots.default)}});return i.default.component("virtual-drag-list",{mixins:[S],props:w,data:function(){return{list:[],uniqueKeys:[],virtual:null,range:{start:0,end:0,front:0,behind:0},drag:null}},provide:function(){return{virtual:this}},computed:{isHorizontal:function(){return"vertical"!==this.direction},scrollSizeKey:function(){return this.isHorizontal?"scrollWidth":"scrollHeight"},scrollDirectionKey:function(){return this.isHorizontal?"scrollLeft":"scrollTop"},offsetSizeKey:function(){return this.isHorizontal?"offsetLeft":"offsetTop"},clientSizeKey:function(){return this.isHorizontal?"clientWidth":"clientHeight"}},watch:{dataSource:{handler:function(t){this.initVirtual(t)},deep:!0,immediate:!0},disabled:{handler:function(t){var e=this;t?this._destroySortable():this.$nextTick(function(){return e._initSortable()})},immediate:!0}},beforeDestroy:function(){this._destroySortable()},methods:{reset:function(){this.scrollToTop(),this.initVirtual(this.dataSource)},getSize:function(t){return this.virtual.sizes.get(t)},getOffset:function(){var t=this.$refs.root;return t?Math.ceil(t[this.scrollDirectionKey]):0},scrollToTop:function(){this.$refs.root[this.scrollDirectionKey]=0},scrollToBottom:function(){var t=this,e=this.$refs,i=e.bottomItem,n=e.root;i&&(i=i[this.offsetSizeKey],this.scrollToOffset(i),setTimeout(function(){t.getOffset()+Math.ceil(n[t.clientSizeKey])<Math.ceil(n[t.scrollSizeKey])&&t.scrollToBottom()},5))},scrollToIndex:function(t){var e,i=this;t>=this.list.length-1?this.scrollToBottom():(e=this.virtual.getOffsetByIndex(t),this.scrollToOffset(e),setTimeout(function(){i.getOffset()!==i.virtual.getOffsetByIndex(t)&&i.scrollToIndex(t)},5))},scrollToOffset:function(t){this.$refs.root[this.scrollDirectionKey]=t},handleDragEnd:function(t,e,i,n){this.virtual.updateUniqueKeys(this.uniqueKeys),this.$emit("ondragend",t,e,i,n)},initVirtual:function(t){var e=this;this.list=h(t),this.uniqueKeys=this.list.map(function(t){return e._getUniqueKey(t)}),this.virtual=new y({size:this.size,keeps:this.keeps,uniqueKeys:this.uniqueKeys,isHorizontal:this.isHorizontal},function(t){e.range=t}),this.virtual.updateRange(),this.virtual.updateSizes(this.uniqueKeys)},_handleScroll:function(t){var e=this.$refs.root,i=this.getOffset(),n=Math.ceil(e[this.clientSizeKey]),e=Math.ceil(e[this.scrollSizeKey]);i<0||e+1<i+n||!e||(this.virtual.handleScroll(i),this.virtual.isFront()?this.list.length&&i<=0&&this.handleToTop(this):this.virtual.isBehind()&&e<=n+i&&this.handleToBottom(this))},handleToTop:m(function(t){t.$emit("top")}),handleToBottom:m(function(t){t.$emit("bottom")}),_onItemResized:function(t,e){this.virtual.handleItemSizeChange(t,e)},_onHeaderResized:function(t,e){this.virtual.handleHeaderSizeChange(e)},_onFooterResized:function(t,e){this.virtual.handleFooterSizeChange(e)},_getUniqueKey:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=this.dataKey;return(Array.isArray(i)?i:i.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce(function(t,e){return(t||{})[e]},t)||e},_getItemIndex:function(e){var i=this;return this.list.findIndex(function(t){return i._getUniqueKey(e)==i._getUniqueKey(t)})}},render:function(n){var o=this,t=this.$slots,e=t.header,i=t.footer,r=this.height,s=this.isHorizontal,a=this.rootClass,l=this.headerTag,h=this.footerTag,c=this.itemTag,u=this.itemStyle,f=this.itemClass,d=this.wrapClass,p=this.range,g=p.start,y=p.end,t=p.front,p=p.behind,r=v(v({},this.rootStyle),{},{height:r,overflow:s?"auto hidden":"hidden auto"}),p=v(v({},this.wrapStyle),{},{padding:s?"0px ".concat(p,"px 0px ").concat(t,"px"):"".concat(t,"px 0px ").concat(p,"px")});return n("div",{ref:"root",class:a,style:r,on:{"&scroll":m(this._handleScroll,this.delay)}},[e?n(z,{props:{tag:l,uniqueKey:"header",event:"_onHeaderResized"}},e):null,n("div",{ref:"wrapper",attrs:{role:"wrapper"},class:d,style:p},this.list.slice(g,y+1).map(function(t){var e=o._getItemIndex(t),i=o._getUniqueKey(t);return o.$scopedSlots.item?n(E,{key:i,props:{isHorizontal:s,uniqueKey:i,tag:c,event:"_onItemResized"},style:u,class:f},o.$scopedSlots.item({record:t,index:e,dataKey:i})):n(c,{key:i,attrs:{"data-key":i},style:v(v({},u),{},{height:"".concat(o.size,"px")}),class:f},i)})),i?n(z,{props:{tag:h,uniqueKey:"footer",event:"_onFooterResized"}},i):null,n("div",{ref:"bottomItem",style:{width:s?"0px":"100%",height:s?"100%":"0px"}})])}})});
