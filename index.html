<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>vue-virtual-drag-list</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="./dist/draglist.js"></script>
    <script src="./test/mock.js"></script>
    <script src="./test/sentences.js"></script>
    <style>
      html, body {
        height: 100%;
        width: 100%;
        padding: 0;
        margin: 0;
      }
      #app {
        height: 100%;
      }
      .draggable-virtual-list {
        width: 500px;
        height: 500px;
        margin: 0 auto;
      }
      .content {
        height: 100%;
        overflow: auto;
      }
      .index {
        min-width: 30px;
        color: #1984ff;
        cursor: grab;
      }
      .test-item {
        padding: 16px;
        border-bottom: 1px solid #1984ff;
      }
      .loading {
        font-size: 16px;
        height: 20px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="header">
        <button @click="reset">reset</button>
        <button @click="editing = !editing">change editing</button>
        <button @click="getSize">getSize</button>
        <button @click="toBottom">bottom</button>
        <button @click="toIndex">toIndex30</button>
        <button @click="toOffset">toOffset500</button>
      </div>
      <visible-list :editing="editing" :data-source="dataSource"></visible-list>
    </div>
    <script type="text/javascript">
      Vue.component('visible-list', {
        props: {
          editing: {},
          dataSource: {
            type: Array,
            default: () => {
              return []
            }
          }
        },
        methods: {
          handleTop() {
            console.log('is to top')
          },
          handleBottom() {
            console.log('is to bottom')
          },
          ondragend(arr, _old, _new, chnaged) {
            console.log(arr, _old, _new, chnaged, 'new states after drag end')
          },
          handleClick() {
            console.log('click')
          }
        },
        render(h) {
          return h('div', {
            attrs: {
              class: 'draggable-virtual-list',
            }
          }, 
          [
            h(VirtualDragList, {
              ref: 'list',
              props: {
                dataSource: this.dataSource,
                dataKey: 'id',
                keeps: 20,
                size: 60,
                disabled: !this.editing,
                draggable: '.drag',
              },
              on: {
                top: this.handleTop,
                bottom: this.handleBottom,
                ondragend: this.ondragend
              },
              scopedSlots: {
                item: props => {
                  return h('div', {
                    class: 'test-item',
                  }, 
                  [
                    this.editing ? h('div', {
                      class: 'drag index',
                      on: {
                        click: this.handleClick
                      }
                    }, props.record.id) : null,
                    h('span', {}, props.record.desc)
                  ])
                }
              }
            },[
              h('div', { slot: 'header', class: 'loading' }, 'header'),
              h('div', { slot: 'footer', class: 'loading' }, 'footer')
            ])
          ])
        }
      });
      new Vue({
        el: '#app',
        data() {
          return {
            editing: true,
            dataSource: getPageData(60, 0),
          }
        },
        methods: {
          reset() {
            this.$children[0].$refs.list.reset();
          },
          toBottom() {
            this.$children[0].$refs.list.scrollToBottom();
          },
          toIndex() {
            this.$children[0].$refs.list.scrollToIndex(30);
          },
          toOffset() {
            this.$children[0].$refs.list.scrollToOffset(500);
          },
          getSize() {
            this.dataSource.forEach(item => {
              const size = this.$children[0].$refs.list.getSize(item.id)
              console.log(size)
            })
          }
        }
      });
    </script>
  </body>
</html>